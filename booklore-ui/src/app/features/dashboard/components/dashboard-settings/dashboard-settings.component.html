<div class="dashboard-settings">
  <div class="panel-header">
    <div class="header-icon-wrapper">
      <i class="pi pi-sliders-h header-icon"></i>
    </div>
    <div class="header-text">
      <h2 class="panel-title">Dashboard Configuration</h2>
      <p class="panel-description">Add up to 5 scrollers from different book collections and customize their behavior</p>
    </div>
    <p-button
      icon="pi pi-times"
      [text]="true"
      [rounded]="true"
      severity="secondary"
      (onClick)="cancel()"
      class="close-button"
    />
  </div>

  <div class="scrollers-container">
    @for (scroller of config.scrollers; track scroller.id; let i = $index) {
      <div class="scroller-item">
        <div class="scroller-content">
          <div class="scroller-controls-left">
            <p-checkbox [(ngModel)]="scroller.enabled" [binary]="true"></p-checkbox>
          </div>

          <div class="scroller-fields">
            <div class="scroller-field" [class.expanded]="scroller.type !== 'magicShelf'">
              <label>Type</label>
              <p-select
                fluid
                [options]="availableScrollerTypes"
                [(ngModel)]="scroller.type"
                (onChange)="onScrollerTypeChange(scroller)"
                placeholder="Select type"
                appendTo="body">
              </p-select>
            </div>

            @if (scroller.type === 'magicShelf') {
              <div class="scroller-field">
                <label>Magic Shelf</label>
                <p-select
                  fluid
                  [options]="(magicShelves$ | async)!"
                  [(ngModel)]="scroller.magicShelfId"
                  placeholder="Select magic shelf"
                  appendTo="body">
                </p-select>
              </div>

              <div class="scroller-field">
                <label>Sort Field</label>
                <p-select
                  fluid
                  [options]="sortFieldOptions"
                  [(ngModel)]="scroller.sortField"
                  placeholder="Select field"
                  appendTo="body">
                </p-select>
              </div>

              <div class="scroller-field">
                <label>Direction</label>
                <p-select
                  fluid
                  [options]="sortDirectionOptions"
                  [(ngModel)]="scroller.sortDirection"
                  placeholder="Select direction"
                  appendTo="body">
                </p-select>
              </div>
            }
          </div>

          <div class="scroller-field max-items-field">
            <label>Max Items</label>
            <p-inputNumber
              fluid
              [(ngModel)]="scroller.maxItems"
              [min]="MIN_ITEMS"
              [max]="MAX_ITEMS"
              [showButtons]="true">
            </p-inputNumber>
          </div>

          <div class="scroller-controls-right">
            <p-button
              icon="pi pi-arrow-up"
              outlined
              rounded
              severity="info"
              size="small"
              [disabled]="i === 0"
              (click)="moveUp(i)">
            </p-button>
            <p-button
              icon="pi pi-arrow-down"
              outlined
              rounded
              severity="info"
              size="small"
              [disabled]="i === config.scrollers.length - 1"
              (click)="moveDown(i)">
            </p-button>
            <p-button
              icon="pi pi-trash"
              outlined
              rounded
              size="small"
              severity="danger"
              (click)="removeScroller(i)"
              [disabled]="config.scrollers.length === 1">
            </p-button>
          </div>
        </div>
      </div>
    }
  </div>

  <div class="dialog-footer">
    <div class="footer-left">
      <p-button
        label="Add Scroller"
        icon="pi pi-plus"
        severity="primary"
        (click)="addScroller()"
        [disabled]="config.scrollers.length >= 5">
      </p-button>
      <p-button
        label="Reset to Default"
        icon="pi pi-refresh"
        severity="secondary"
        text
        (click)="resetToDefault()">
      </p-button>
    </div>
    <div class="footer-actions">
      <p-button
        label="Cancel"
        [outlined]="true"
        severity="secondary"
        (click)="cancel()">
      </p-button>
      <p-button
        label="Save"
        icon="pi pi-check"
        severity="success"
        (click)="save()">
      </p-button>
    </div>
  </div>
</div>
