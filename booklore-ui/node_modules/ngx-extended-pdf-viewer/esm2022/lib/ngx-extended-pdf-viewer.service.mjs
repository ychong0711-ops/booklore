import { effect, Injectable } from '@angular/core';
import { AnnotationEditorParamsType, AnnotationMode } from './options/editor-annotations';
import * as i0 from "@angular/core";
import * as i1 from "./pdf-notification-service";
export class NgxExtendedPdfViewerService {
    rendererFactory;
    ngxExtendedPdfViewerInitialized = false;
    secondaryMenuIsEmpty = false;
    renderer;
    PDFViewerApplication;
    constructor(rendererFactory, notificationService) {
        this.rendererFactory = rendererFactory;
        this.renderer = this.rendererFactory.createRenderer(null, null);
        effect(() => {
            this.PDFViewerApplication = notificationService.onPDFJSInitSignal();
        });
    }
    find(text, options = {}) {
        if (!this.ngxExtendedPdfViewerInitialized) {
            // tslint:disable-next-line:quotemark
            console.error("The PDF viewer hasn't finished initializing. Please call find() later.");
            return undefined;
        }
        else {
            if (!options.useSecondaryFindcontroller) {
                const highlightAllCheckbox = document.getElementById('findHighlightAll');
                if (highlightAllCheckbox) {
                    highlightAllCheckbox.checked = options.highlightAll ?? false;
                }
                const matchCaseCheckbox = document.getElementById('findMatchCase');
                if (matchCaseCheckbox) {
                    matchCaseCheckbox.checked = options.matchCase ?? false;
                }
                const findMultipleCheckbox = document.getElementById('findMultiple');
                if (findMultipleCheckbox) {
                    findMultipleCheckbox.checked = options.findMultiple ?? false;
                }
                const entireWordCheckbox = document.getElementById('findEntireWord');
                if (entireWordCheckbox) {
                    entireWordCheckbox.checked = options.wholeWords ?? false;
                }
                const matchDiacriticsCheckbox = document.getElementById('findMatchDiacritics');
                if (matchDiacriticsCheckbox) {
                    matchDiacriticsCheckbox.checked = options.matchDiacritics ?? false;
                }
                const matchRegExpCheckbox = document.getElementById('matchRegExp');
                if (matchRegExpCheckbox) {
                    matchRegExpCheckbox.checked = options.regexp ?? false;
                    if (matchRegExpCheckbox.checked) {
                        if (findMultipleCheckbox) {
                            findMultipleCheckbox.checked = false;
                        }
                        if (entireWordCheckbox) {
                            entireWordCheckbox.checked = false;
                        }
                        if (matchDiacriticsCheckbox) {
                            matchDiacriticsCheckbox.checked = false;
                        }
                    }
                    if (findMultipleCheckbox) {
                        findMultipleCheckbox.disabled = matchRegExpCheckbox.checked;
                    }
                    if (entireWordCheckbox) {
                        entireWordCheckbox.disabled = matchRegExpCheckbox.checked;
                    }
                    if (matchDiacriticsCheckbox) {
                        matchDiacriticsCheckbox.disabled = matchRegExpCheckbox.checked;
                    }
                }
                const inputField = document.getElementById('findInput');
                if (inputField && typeof text === 'string') {
                    inputField.value = text;
                }
            }
            const findParameters = {
                caseSensitive: options.matchCase ?? false,
                entireWord: options.wholeWords ?? false,
                highlightAll: options.highlightAll ?? false,
                matchDiacritics: options.matchDiacritics ?? false,
                findMultiple: options.findMultiple,
                matchRegExp: options.regexp ?? false,
                findPrevious: false,
                query: text,
                source: null,
                type: 'find',
                dontScrollIntoView: options.dontScrollIntoView ?? false,
            };
            const findController = options.useSecondaryFindcontroller ? this.PDFViewerApplication?.customFindController : this.PDFViewerApplication?.findController;
            const result = findController?.ngxFind(findParameters);
            return result;
        }
    }
    findNext(useSecondaryFindcontroller = false) {
        if (!this.ngxExtendedPdfViewerInitialized) {
            // tslint:disable-next-line:quotemark
            console.error("The PDF viewer hasn't finished initializing. Please call findNext() later.");
            return false;
        }
        else {
            const findController = useSecondaryFindcontroller ? this.PDFViewerApplication?.customFindController : this.PDFViewerApplication?.findController;
            findController?.ngxFindNext();
            return true;
        }
    }
    findPrevious(useSecondaryFindcontroller = false) {
        if (!this.ngxExtendedPdfViewerInitialized) {
            // tslint:disable-next-line:quotemark
            console.error("The PDF viewer hasn't finished initializing. Please call findPrevious() later.");
            return false;
        }
        else {
            const findController = useSecondaryFindcontroller ? this.PDFViewerApplication?.customFindController : this.PDFViewerApplication?.findController;
            findController?.ngxFindPrevious();
            return true;
        }
    }
    print(printRange) {
        if (this.PDFViewerApplication) {
            const alreadyPrinting = this.PDFViewerApplication?.PDFPrintServiceFactory?.isInPDFPrintRange !== undefined;
            if (!alreadyPrinting) {
                // slow down hurried users clicking the print button multiple times
                if (!printRange) {
                    printRange = {};
                }
                this.setPrintRange(printRange);
                this.PDFViewerApplication?.printPdf();
                this.PDFViewerApplication?.eventBus.on('afterprint', this.removePrintRange.bind(this), { once: true });
            }
        }
    }
    removePrintRange() {
        if (this.PDFViewerApplication?.PDFPrintServiceFactory) {
            delete this.PDFViewerApplication.PDFPrintServiceFactory.isInPDFPrintRange;
            delete this.PDFViewerApplication.PDFPrintServiceFactory.filteredPageCount;
        }
    }
    setPrintRange(printRange) {
        if (!this.PDFViewerApplication?.PDFPrintServiceFactory) {
            console.error("The print service hasn't been initialized yet.");
            return;
        }
        this.PDFViewerApplication.PDFPrintServiceFactory.isInPDFPrintRange = (page) => this.isInPDFPrintRange(page, printRange);
        this.PDFViewerApplication.PDFPrintServiceFactory.filteredPageCount = this.filteredPageCount(this.PDFViewerApplication?.pagesCount, printRange);
    }
    filteredPageCount(pageCount, range) {
        let result = 0;
        for (let page = 0; page < pageCount; page++) {
            if (this.isInPDFPrintRange(page, range)) {
                result++;
            }
        }
        return result;
    }
    isInPDFPrintRange(pageIndex, printRange) {
        const page = pageIndex + 1;
        if (printRange.from) {
            if (page < printRange.from) {
                return false;
            }
        }
        if (printRange.to) {
            if (page > printRange.to) {
                return false;
            }
        }
        if (printRange.excluded) {
            if (printRange.excluded.some((p) => p === page)) {
                return false;
            }
        }
        if (printRange.included) {
            if (!printRange.included.some((p) => p === page)) {
                return false;
            }
        }
        return true;
    }
    async getPageAsLines(pageNumber) {
        if (this.PDFViewerApplication) {
            const pdfDocument = this.PDFViewerApplication?.pdfDocument;
            const page = await pdfDocument.getPage(pageNumber);
            const textSnippets = (await page.getTextContent()).items //
                .filter((info) => !info['type']); // ignore the TextMarkedContent items
            const snippets = textSnippets;
            let minX = Number.MAX_SAFE_INTEGER;
            let minY = Number.MAX_SAFE_INTEGER;
            let maxX = Number.MIN_SAFE_INTEGER;
            let maxY = Number.MIN_SAFE_INTEGER;
            let countLTR = 0;
            let countRTL = 0;
            let text = '';
            let lines = new Array();
            for (let i = 0; i < snippets.length; i++) {
                const currentSnippet = snippets[i];
                // #3065 modified by ngx-extended-pdf-viewer
                // Always process the current snippet's text and bounds, regardless of hasEOL
                const x = currentSnippet.transform[4];
                const y = -currentSnippet.transform[5];
                const width = currentSnippet.width;
                const height = currentSnippet.height;
                minX = Math.min(minX, x);
                minY = Math.min(minY, y);
                maxX = Math.max(maxX, x + width);
                maxY = Math.max(maxY, y + height);
                text += currentSnippet.str;
                if (currentSnippet.dir === 'rtl') {
                    countRTL++;
                }
                if (currentSnippet.dir === 'ltr') {
                    countLTR++;
                }
                // #3065 end of modification by ngx-extended-pdf-viewer
                let addIt = i === snippets.length - 1 || currentSnippet.hasEOL;
                if (addIt) {
                    let direction = undefined;
                    if (countLTR > 0 && countRTL > 0) {
                        direction = 'both';
                    }
                    else if (countLTR > 0) {
                        direction = 'ltr';
                    }
                    else if (countRTL > 0) {
                        direction = 'rtl';
                    }
                    const line = {
                        direction,
                        x: minX,
                        y: minY,
                        width: maxX - minX,
                        height: maxY - minY,
                        text: text.trim(),
                    };
                    lines.push(line);
                    minX = Number.MAX_SAFE_INTEGER;
                    minY = Number.MAX_SAFE_INTEGER;
                    maxX = Number.MIN_SAFE_INTEGER;
                    maxY = Number.MIN_SAFE_INTEGER;
                    countLTR = 0;
                    countRTL = 0;
                    text = '';
                }
            }
            return lines;
        }
        return [];
    }
    async getPageAsText(pageNumber) {
        if (!this.PDFViewerApplication) {
            return '';
        }
        const pdfDocument = this.PDFViewerApplication?.pdfDocument;
        const page = await pdfDocument.getPage(pageNumber);
        const textSnippets = (await page.getTextContent()).items;
        return this.convertTextInfoToText(textSnippets);
    }
    convertTextInfoToText(textInfoItems) {
        if (!textInfoItems) {
            return '';
        }
        return textInfoItems
            .filter((info) => !info['type'])
            .map((info) => (info.hasEOL ? info.str + '\n' : info.str))
            .join('');
    }
    async getPageAsCanvas(pageNumber, scale, background, backgroundColorToReplace = '#FFFFFF', annotationMode = AnnotationMode.ENABLE) {
        if (!this.PDFViewerApplication) {
            return Promise.resolve(undefined);
        }
        const pdfDocument = this.PDFViewerApplication.pdfDocument;
        const pdfPage = await pdfDocument.getPage(pageNumber);
        return this.draw(pdfPage, scale, background, backgroundColorToReplace, annotationMode);
    }
    async getPageAsImage(pageNumber, scale, background, backgroundColorToReplace = '#FFFFFF', annotationMode = AnnotationMode.ENABLE) {
        const canvas = await this.getPageAsCanvas(pageNumber, scale, background, backgroundColorToReplace, annotationMode);
        return canvas?.toDataURL();
    }
    async draw(pdfPage, scale, background, backgroundColorToReplace = '#FFFFFF', annotationMode = AnnotationMode.ENABLE) {
        let zoomFactor = 1;
        if (scale.scale) {
            zoomFactor = scale.scale;
        }
        else if (scale.width) {
            zoomFactor = scale.width / pdfPage.getViewport({ scale: 1 }).width;
        }
        else if (scale.height) {
            zoomFactor = scale.height / pdfPage.getViewport({ scale: 1 }).height;
        }
        const viewport = pdfPage.getViewport({
            scale: zoomFactor,
        });
        const { ctx, canvas } = this.getPageDrawContext(viewport.width, viewport.height);
        const drawViewport = viewport.clone();
        const renderContext = {
            canvasContext: ctx,
            viewport: drawViewport,
            background,
            backgroundColorToReplace,
            annotationMode,
        };
        const renderTask = pdfPage.render(renderContext);
        const dataUrlPromise = () => Promise.resolve(canvas);
        return renderTask.promise.then(dataUrlPromise);
    }
    getPageDrawContext(width, height) {
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d', { alpha: true });
        if (!ctx) {
            // tslint:disable-next-line: quotemark
            throw new Error("Couldn't create the 2d context");
        }
        canvas.width = width;
        canvas.height = height;
        this.renderer.setStyle(canvas, 'width', `${width}px`);
        this.renderer.setStyle(canvas, 'height', `${height}px`);
        return { ctx, canvas };
    }
    async getCurrentDocumentAsBlob() {
        return (await this.PDFViewerApplication?.export()) || undefined;
    }
    async getFormData(currentFormValues = true) {
        if (!this.PDFViewerApplication) {
            return [];
        }
        const pdf = this.PDFViewerApplication?.pdfDocument;
        // screen DPI / PDF DPI
        const dpiRatio = 96 / 72;
        const result = [];
        for (let i = 1; i <= pdf?.numPages; i++) {
            // track the current page
            const currentPage /* : PDFPageProxy */ = await pdf.getPage(i);
            const annotations = await currentPage.getAnnotations();
            annotations
                .filter((a) => a.subtype === 'Widget') // get the form field annotations only
                .map((a) => ({ ...a })) // only expose copies of the annotations to avoid side-effects
                .forEach((a) => {
                // get the rectangle that represent the single field
                // and resize it according to the current DPI
                const fieldRect = currentPage.getViewport({ scale: dpiRatio }).convertToViewportRectangle(a.rect);
                // add the corresponding input
                if (currentFormValues && a.fieldName) {
                    try {
                        if (a.exportValue) {
                            const currentValue = this.PDFViewerApplication?.pdfDocument.annotationStorage.getValue(a.id, a.fieldName + '/' + a.exportValue, '');
                            a.value = currentValue?.value;
                        }
                        else if (a.radioButton) {
                            const currentValue = this.PDFViewerApplication?.pdfDocument.annotationStorage.getValue(a.id, a.fieldName + '/' + a.fieldValue, '');
                            a.value = currentValue?.value;
                        }
                        else {
                            const currentValue = this.PDFViewerApplication?.pdfDocument.annotationStorage.getValue(a.id, a.fieldName, '');
                            a.value = currentValue?.value;
                        }
                    }
                    catch (exception) {
                        // just ignore it
                    }
                }
                result.push({ fieldAnnotation: a, fieldRect, pageNumber: i });
            });
        }
        return result;
    }
    /**
     * Adds a page to the rendering queue
     * @param {number} pageIndex Index of the page to render
     * @returns {boolean} false, if the page has already been rendered,
     * if it's out of range or if the viewer hasn't been initialized yet
     */
    addPageToRenderQueue(pageIndex) {
        return this.PDFViewerApplication?.pdfViewer.addPageToRenderQueue(pageIndex) ?? false;
    }
    isRenderQueueEmpty() {
        const scrolledDown = true;
        const renderExtra = false;
        if (this.PDFViewerApplication) {
            const nextPage = this.PDFViewerApplication.pdfViewer.renderingQueue.getHighestPriority(this.PDFViewerApplication?.pdfViewer._getVisiblePages(), this.PDFViewerApplication?.pdfViewer._pages, scrolledDown, renderExtra);
            return !nextPage;
        }
        return true;
    }
    hasPageBeenRendered(pageIndex) {
        if (!this.PDFViewerApplication) {
            return false;
        }
        const pages = this.PDFViewerApplication?.pdfViewer._pages;
        if (pages.length > pageIndex && pageIndex >= 0) {
            const pageView = pages[pageIndex];
            const hasBeenRendered = pageView.renderingState === 3;
            return hasBeenRendered;
        }
        return false;
    }
    sleep(ms) {
        return new Promise((resolve) => setTimeout(resolve, ms));
    }
    async renderPage(pageIndex) {
        if (!this.hasPageBeenRendered(pageIndex)) {
            await this.addPageToRenderQueue(pageIndex);
            while (!this.hasPageBeenRendered(pageIndex)) {
                await this.sleep(7);
            }
        }
    }
    currentlyRenderedPages() {
        if (!this.PDFViewerApplication) {
            return [];
        }
        const pages = this.PDFViewerApplication?.pdfViewer._pages;
        return pages.filter((page) => page.renderingState === 3).map((page) => page.id);
    }
    numberOfPages() {
        if (!this.PDFViewerApplication) {
            return 0;
        }
        const pages = this.PDFViewerApplication?.pdfViewer._pages;
        return pages.length;
    }
    getCurrentlyVisiblePageNumbers() {
        const app = this.PDFViewerApplication;
        if (!app) {
            return [];
        }
        const pages = app.pdfViewer._getVisiblePages().views;
        return pages?.map((page) => page.id);
    }
    async listLayers() {
        if (!this.PDFViewerApplication) {
            return [];
        }
        const optionalContentConfig = await this.PDFViewerApplication?.pdfViewer.optionalContentConfigPromise;
        if (optionalContentConfig) {
            const levelData = optionalContentConfig.getOrder();
            const layerIds = levelData.filter((groupId) => typeof groupId !== 'object');
            return layerIds.map((layerId) => {
                const config = optionalContentConfig.getGroup(layerId);
                return {
                    layerId: layerId,
                    name: config.name,
                    visible: config.visible,
                };
            });
        }
        return undefined;
    }
    async toggleLayer(layerId) {
        if (!this.PDFViewerApplication) {
            return;
        }
        const optionalContentConfig = await this.PDFViewerApplication?.pdfViewer.optionalContentConfigPromise;
        if (optionalContentConfig) {
            let isVisible = optionalContentConfig.getGroup(layerId).visible;
            const checkbox = document.querySelector(`input[id='${layerId}']`);
            if (checkbox) {
                isVisible = checkbox.checked;
                checkbox.checked = !isVisible;
            }
            optionalContentConfig.setVisibility(layerId, !isVisible);
            this.PDFViewerApplication?.eventBus.dispatch('optionalcontentconfig', {
                source: this,
                promise: Promise.resolve(optionalContentConfig),
            });
        }
    }
    scrollPageIntoView(pageNumber, pageSpot) {
        const viewer = this.PDFViewerApplication?.pdfViewer;
        viewer?.scrollPagePosIntoView(pageNumber, pageSpot);
    }
    /**
     * Returns all editor annotations (drawings, text, images, highlights) in serialized format.
     *
     * **IMPORTANT - ID Behavior:**
     * - Each annotation includes an `id` field for real-time event tracking via `annotationEditorEvent`
     * - When re-applying annotations using `addEditorAnnotation()`, **new IDs are always assigned**
     * - IDs are **not persistent** across sessions - they are temporary identifiers
     * - If you need to store annotations for later use, you can safely **omit the `id` field**
     *
     * **Example - Storing and Re-applying Annotations:**
     * ```typescript
     * // Save annotations (IDs are optional to store)
     * const annotations = pdfService.getSerializedAnnotations();
     * const toStore = annotations.map(({ id, ...rest }) => rest); // Remove IDs
     * localStorage.setItem('annotations', JSON.stringify(toStore));
     *
     * // Re-apply annotations (new IDs will be assigned automatically)
     * const stored = JSON.parse(localStorage.getItem('annotations'));
     * await pdfService.addEditorAnnotation(stored);
     * ```
     *
     * @returns Array of serialized annotations with temporary IDs, or null if no annotations exist
     */
    getSerializedAnnotations() {
        return this.PDFViewerApplication?.pdfViewer.getSerializedAnnotations();
    }
    // #3076 added by ngx-extended-pdf-viewer
    /**
     * Returns a single editor annotation by its ID.
     *
     * **IMPORTANT - ID Behavior:**
     * - IDs are temporary and only valid during the current session
     * - Useful for responding to `annotationEditorEvent` events
     * - Do not rely on IDs to persist across document reloads or sessions
     *
     * @param id The temporary unique identifier of the annotation (from `annotationEditorEvent` or `getSerializedAnnotations()`)
     * @returns The serialized annotation matching the ID, or null if not found
     */
    getSerializedAnnotation(id) {
        const annotations = this.PDFViewerApplication?.pdfViewer.getSerializedAnnotations();
        if (!annotations || !Array.isArray(annotations)) {
            return null;
        }
        return annotations.find((annotation) => annotation.id === id) || null;
    }
    // #3076 end of modification by ngx-extended-pdf-viewer
    /**
     * Programmatically adds one or more editor annotations to the PDF.
     *
     * **IMPORTANT - ID Behavior:**
     * - Any `id` fields in the provided annotations are **ignored**
     * - New unique IDs are always assigned automatically
     * - This ensures no ID conflicts occur
     * - The `id` field is optional when calling this method
     *
     * **Supported Annotation Types:**
     * - Ink (drawings)
     * - FreeText (text boxes)
     * - Stamp (images)
     * - Highlight
     * - Popup (comments)
     *
     * @param serializedAnnotation A single annotation object, array of annotations, or JSON string
     * @returns Promise that resolves when the annotation(s) have been added
     *
     * @example
     * // Add a single annotation (with or without ID - both work the same)
     * await pdfService.addEditorAnnotation({
     *   annotationType: 3,
     *   color: [255, 0, 0],
     *   value: 'Hello',
     *   pageIndex: 0,
     *   rect: [100, 100, 200, 150],
     *   rotation: 0
     *   // id field is optional and will be ignored if provided
     * });
     */
    async addEditorAnnotation(serializedAnnotation) {
        // #3061 When the editor mode is NONE, PDF.js internally switches to FREETEXT mode temporarily,
        // which causes the FreeText popup to flash. Prevent this by hiding the popup during the operation.
        const currentMode = this.PDFViewerApplication?.pdfViewer.annotationEditorMode;
        const popup = document.getElementById('editorFreeTextParamsToolbar');
        const wasHidden = popup?.classList.contains('hidden') ?? true;
        // If mode is NONE and popup was hidden, keep it hidden during the temporary mode switch
        if (currentMode === 0 && wasHidden && popup) {
            this.renderer.addClass(popup, 'ngx-keep-hidden');
        }
        await this.PDFViewerApplication?.pdfViewer.addEditorAnnotation(serializedAnnotation);
        // #3061 Remove the temporary hiding class after the operation
        if (currentMode === 0 && wasHidden && popup) {
            this.renderer.removeClass(popup, 'ngx-keep-hidden');
        }
    }
    removeEditorAnnotations(filter) {
        this.PDFViewerApplication?.pdfViewer.removeEditorAnnotations(filter);
    }
    async loadImageAsDataURL(imageUrl) {
        if (imageUrl.startsWith('data:')) {
            return imageUrl;
        }
        const response = await fetch(imageUrl);
        if (!response.ok) {
            throw new Error(`Failed to fetch the image from ${imageUrl}: ${response.statusText}`);
        }
        const imageBlob = await response.blob();
        return imageBlob;
    }
    async addImageToAnnotationLayer({ urlOrDataUrl, page, left, bottom, right, top, rotation }) {
        if (!this.PDFViewerApplication) {
            console.error('The PDF viewer has not been initialized yet.');
            return;
        }
        let pageToModify;
        if (page !== undefined) {
            if (page !== this.currentPageIndex()) {
                await this.renderPage(page);
            }
            pageToModify = page;
        }
        else {
            pageToModify = this.currentPageIndex() ?? 0;
        }
        const previousAnnotationEditorMode = this.PDFViewerApplication.pdfViewer.annotationEditorMode;
        // #3061 Check if the stamp popup is currently hidden to prevent flashing
        const popup = document.getElementById('editorStampParamsToolbar');
        const wasHidden = popup?.classList.contains('hidden') ?? true;
        // If the popup was hidden, add a CSS class to keep it hidden during mode switch
        if (wasHidden && popup) {
            this.renderer.addClass(popup, 'ngx-keep-hidden');
        }
        this.switchAnnotationEdtorMode(13);
        const dataUrl = await this.loadImageAsDataURL(urlOrDataUrl);
        const pageSize = this.PDFViewerApplication.pdfViewer._pages[pageToModify].pdfPage.view;
        const leftDim = pageSize[0];
        const bottomDim = pageSize[1];
        const rightDim = pageSize[2];
        const topDim = pageSize[3];
        const width = rightDim - leftDim;
        const height = topDim - bottomDim;
        const imageWidth = this.PDFViewerApplication?.pdfViewer._pages[pageToModify].div.clientWidth;
        const imageHeight = this.PDFViewerApplication?.pdfViewer._pages[pageToModify].div.clientHeight;
        const leftPdf = this.convertToPDFCoordinates(left, width, 0, imageWidth);
        const bottomPdf = this.convertToPDFCoordinates(bottom, height, 0, imageHeight);
        const rightPdf = this.convertToPDFCoordinates(right, width, width, imageWidth);
        const topPdf = this.convertToPDFCoordinates(top, height, height, imageHeight);
        const stampAnnotation = {
            annotationType: 13,
            pageIndex: pageToModify,
            bitmapUrl: dataUrl,
            rect: [leftPdf, bottomPdf, rightPdf, topPdf],
            rotation: rotation ?? 0,
            isCopy: true,
        };
        this.addEditorAnnotation(stampAnnotation);
        await this.sleep(10);
        this.switchAnnotationEdtorMode(previousAnnotationEditorMode);
        // #3061 Remove the temporary hiding class after switching back
        if (wasHidden && popup) {
            this.renderer.removeClass(popup, 'ngx-keep-hidden');
        }
    }
    async addHighlightToAnnotationLayer(color, page, left, bottom, right, top, thickness = 12, rotation = 0, opacity = 0.5) {
        if (!this.PDFViewerApplication) {
            console.error('The PDF viewer has not been initialized yet.');
            return;
        }
        let pageToModify;
        if (page !== undefined) {
            if (page !== this.currentPageIndex()) {
                await this.renderPage(page);
            }
            pageToModify = page;
        }
        else {
            pageToModify = this.currentPageIndex() ?? 0;
        }
        const previousAnnotationEditorMode = this.PDFViewerApplication.pdfViewer.annotationEditorMode;
        // #3061 Check if the popup is currently hidden to prevent flashing
        const popup = document.getElementById('editorHighlightParamsToolbar');
        const wasHidden = popup?.classList.contains('hidden') ?? true;
        // If the popup was hidden, add a CSS class to keep it hidden during mode switch
        if (wasHidden && popup) {
            this.renderer.addClass(popup, 'ngx-keep-hidden');
        }
        this.switchAnnotationEdtorMode(9); // AnnotationEditorType.HIGHLIGHT
        const pageSize = this.PDFViewerApplication.pdfViewer._pages[pageToModify].pdfPage.view;
        const leftDim = pageSize[0];
        const bottomDim = pageSize[1];
        const rightDim = pageSize[2];
        const topDim = pageSize[3];
        const width = rightDim - leftDim;
        const height = topDim - bottomDim;
        const pageWidth = this.PDFViewerApplication?.pdfViewer._pages[pageToModify].div.clientWidth;
        const pageHeight = this.PDFViewerApplication?.pdfViewer._pages[pageToModify].div.clientHeight;
        const leftPdf = this.convertToPDFCoordinates(left, width, 0, pageWidth);
        const bottomPdf = this.convertToPDFCoordinates(bottom, height, 0, pageHeight);
        const rightPdf = this.convertToPDFCoordinates(right, width, width, pageWidth);
        const topPdf = this.convertToPDFCoordinates(top, height, height, pageHeight);
        // Create quadPoints object with numeric keys (matching export format)
        const quadPoints = {};
        quadPoints[0] = leftPdf; // x1 - left edge start
        quadPoints[1] = topPdf; // y1 - top edge start
        quadPoints[2] = rightPdf; // x2 - right edge end
        quadPoints[3] = topPdf; // y2 - top edge end
        quadPoints[4] = leftPdf; // x3 - left edge start (bottom)
        quadPoints[5] = bottomPdf; // y3 - bottom edge start
        quadPoints[6] = rightPdf; // x4 - right edge end (bottom)
        quadPoints[7] = bottomPdf; // y4 - bottom edge end
        const highlightAnnotation = {
            annotationType: 9,
            color: color,
            opacity: opacity,
            thickness: thickness,
            quadPoints: quadPoints,
            outlines: [
                [
                    // Single outline rectangle
                    leftPdf,
                    bottomPdf,
                    leftPdf,
                    topPdf,
                    rightPdf,
                    topPdf,
                    rightPdf,
                    bottomPdf, // Bottom-right
                ],
            ],
            pageIndex: pageToModify,
            rect: [leftPdf, bottomPdf, rightPdf, topPdf],
            rotation: rotation,
            isCopy: true,
        };
        this.addEditorAnnotation(highlightAnnotation);
        await this.sleep(10);
        this.switchAnnotationEdtorMode(previousAnnotationEditorMode);
        // #3061 Remove the temporary hiding class after switching back
        if (wasHidden && popup) {
            this.renderer.removeClass(popup, 'ngx-keep-hidden');
        }
    }
    currentPageIndex() {
        const viewer = this.PDFViewerApplication?.pdfViewer;
        if (viewer) {
            return viewer.currentPageNumber - 1;
        }
        return undefined;
    }
    convertToPDFCoordinates(value, maxValue, defaultValue, imageMaxValue) {
        if (!value) {
            return defaultValue;
        }
        if (typeof value === 'string') {
            if (value.endsWith('%')) {
                return (parseInt(value, 10) / 100) * maxValue;
            }
            else if (value.endsWith('px')) {
                return parseInt(value, 10) * (maxValue / imageMaxValue);
            }
            else {
                return parseInt(value, 10);
            }
        }
        else {
            return value;
        }
    }
    switchAnnotationEdtorMode(mode) {
        this.PDFViewerApplication?.eventBus.dispatch('switchannotationeditormode', { mode });
    }
    set editorFontSize(size) {
        this.setEditorProperty(AnnotationEditorParamsType.FREETEXT_SIZE, size);
    }
    set editorFontColor(color) {
        this.setEditorProperty(AnnotationEditorParamsType.FREETEXT_COLOR, color);
    }
    set editorInkColor(color) {
        this.setEditorProperty(AnnotationEditorParamsType.INK_COLOR, color);
    }
    set editorInkOpacity(opacity) {
        this.setEditorProperty(AnnotationEditorParamsType.INK_OPACITY, opacity);
    }
    set editorInkThickness(thickness) {
        this.setEditorProperty(AnnotationEditorParamsType.INK_THICKNESS, thickness);
    }
    set editorHighlightColor(color) {
        this.setEditorProperty(AnnotationEditorParamsType.HIGHLIGHT_COLOR, color);
    }
    set editorHighlightDefaultColor(color) {
        this.setEditorProperty(AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR, color);
    }
    set editorHighlightShowAll(showAll) {
        this.setEditorProperty(AnnotationEditorParamsType.HIGHLIGHT_SHOW_ALL, showAll);
    }
    set editorHighlightThickness(thickness) {
        this.setEditorProperty(AnnotationEditorParamsType.HIGHLIGHT_THICKNESS, thickness);
    }
    setEditorProperty(editorPropertyType, value) {
        this.PDFViewerApplication?.eventBus.dispatch('switchannotationeditorparams', { type: editorPropertyType, value });
        this.PDFViewerApplication?.eventBus.dispatch('annotationeditorparamschanged', { details: [[editorPropertyType, value]] });
    }
    getCurrentPage() {
        if (!this.PDFViewerApplication) {
            return 1;
        }
        return this.PDFViewerApplication.page ?? 1;
    }
    getPageCount() {
        if (!this.PDFViewerApplication) {
            return 0;
        }
        return this.PDFViewerApplication.pagesCount ?? 0;
    }
    movePage(fromIndex, toIndex) {
        if (!this.PDFViewerApplication) {
            console.error('PDF viewer not initialized');
            return;
        }
        // Check if page reordering is enabled
        const enablePageReordering = globalThis.pdfDefaultOptions?.enablePageReordering;
        if (!enablePageReordering) {
            console.error('Page reordering is not enabled. Set pdfDefaultOptions.enablePageReordering = true');
            return;
        }
        // Validate indices (1-based)
        const pageCount = this.getPageCount();
        if (fromIndex < 1 || fromIndex > pageCount || toIndex < 1 || toIndex > pageCount) {
            console.error(`Invalid page indices. fromIndex: ${fromIndex}, toIndex: ${toIndex}, pageCount: ${pageCount}`);
            return;
        }
        if (fromIndex === toIndex) {
            return; // No movement needed
        }
        try {
            // Call the movePage function from app.js
            if (this.PDFViewerApplication.movePage) {
                this.PDFViewerApplication.movePage(fromIndex, toIndex);
            }
            else {
                console.error('movePage function not available in PDF viewer application');
            }
        }
        catch (error) {
            console.error('Error moving page:', error);
        }
    }
    static ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.3.12", ngImport: i0, type: NgxExtendedPdfViewerService, deps: [{ token: i0.RendererFactory2 }, { token: i1.PDFNotificationService }], target: i0.ɵɵFactoryTarget.Injectable });
    static ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "17.3.12", ngImport: i0, type: NgxExtendedPdfViewerService, providedIn: 'root' });
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.3.12", ngImport: i0, type: NgxExtendedPdfViewerService, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root',
                }]
        }], ctorParameters: () => [{ type: i0.RendererFactory2 }, { type: i1.PDFNotificationService }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LWV4dGVuZGVkLXBkZi12aWV3ZXIuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Byb2plY3RzL25neC1leHRlbmRlZC1wZGYtdmlld2VyL3NyYy9saWIvbmd4LWV4dGVuZGVkLXBkZi12aWV3ZXIuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFBK0IsTUFBTSxlQUFlLENBQUM7QUFDaEYsT0FBTyxFQUFFLDBCQUEwQixFQUFFLGNBQWMsRUFBc0UsTUFBTSw4QkFBOEIsQ0FBQzs7O0FBNkQ5SixNQUFNLE9BQU8sMkJBQTJCO0lBU25CO0lBUlosK0JBQStCLEdBQUcsS0FBSyxDQUFDO0lBRXhDLG9CQUFvQixHQUFHLEtBQUssQ0FBQztJQUVuQixRQUFRLENBQVk7SUFDN0Isb0JBQW9CLENBQXlCO0lBRXJELFlBQ21CLGVBQWlDLEVBQ2xELG1CQUEyQztRQUQxQixvQkFBZSxHQUFmLGVBQWUsQ0FBa0I7UUFHbEQsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLGNBQWMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDaEUsTUFBTSxDQUFDLEdBQUcsRUFBRTtZQUNWLElBQUksQ0FBQyxvQkFBb0IsR0FBRyxtQkFBbUIsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1FBQ3RFLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVNLElBQUksQ0FBQyxJQUFnQyxFQUFFLFVBQXVCLEVBQUU7UUFDckUsSUFBSSxDQUFDLElBQUksQ0FBQywrQkFBK0IsRUFBRTtZQUN6QyxxQ0FBcUM7WUFDckMsT0FBTyxDQUFDLEtBQUssQ0FBQyx3RUFBd0UsQ0FBQyxDQUFDO1lBQ3hGLE9BQU8sU0FBUyxDQUFDO1NBQ2xCO2FBQU07WUFDTCxJQUFJLENBQUMsT0FBTyxDQUFDLDBCQUEwQixFQUFFO2dCQUN2QyxNQUFNLG9CQUFvQixH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VSxFQUFFLE1BQU07aUJBQ25CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZWZmZWN0LCBJbmplY3RhYmxlLCBSZW5kZXJlcjIsIFJlbmRlcmVyRmFjdG9yeTIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEFubm90YXRpb25FZGl0b3JQYXJhbXNUeXBlLCBBbm5vdGF0aW9uTW9kZSwgRWRpdG9yQW5ub3RhdGlvbiwgSGlnaGxpZ2h0RWRpdG9yQW5ub3RhdGlvbiwgU3RhbXBFZGl0b3JBbm5vdGF0aW9uIH0gZnJvbSAnLi9vcHRpb25zL2VkaXRvci1hbm5vdGF0aW9ucyc7XG5pbXBvcnQgeyBQZGZMYXllciB9IGZyb20gJy4vb3B0aW9ucy9vcHRpb25hbF9jb250ZW50X2NvbmZpZyc7XG5pbXBvcnQgeyBQREZQcmludFJhbmdlIH0gZnJvbSAnLi9vcHRpb25zL3BkZi1wcmludC1yYW5nZSc7XG5pbXBvcnQgeyBJUERGVmlld2VyQXBwbGljYXRpb24sIFBERkRvY3VtZW50UHJveHksIFBERkZpbmRQYXJhbWV0ZXJzLCBQREZQYWdlUHJveHksIFRleHRJdGVtLCBUZXh0TWFya2VkQ29udGVudCB9IGZyb20gJy4vb3B0aW9ucy9wZGYtdmlld2VyLWFwcGxpY2F0aW9uJztcbmltcG9ydCB7IFpvb21UeXBlIH0gZnJvbSAnLi9vcHRpb25zL3pvb20tdHlwZSc7XG5pbXBvcnQgeyBQREZOb3RpZmljYXRpb25TZXJ2aWNlIH0gZnJvbSAnLi9wZGYtbm90aWZpY2F0aW9uLXNlcnZpY2UnO1xuXG5leHBvcnQgaW50ZXJmYWNlIEZpbmRPcHRpb25zIHtcbiAgaGlnaGxpZ2h0QWxsPzogYm9vbGVhbjtcbiAgbWF0Y2hDYXNlPzogYm9vbGVhbjtcbiAgd2hvbGVXb3Jkcz86IGJvb2xlYW47XG4gIG1hdGNoRGlhY3JpdGljcz86IGJvb2xlYW47XG4gIGRvbnRTY3JvbGxJbnRvVmlldz86IGJvb2xlYW47XG4gIGZpbmRNdWx0aXBsZT86IGJvb2xlYW47XG4gIHJlZ2V4cD86IGJvb2xlYW47XG4gIHVzZVNlY29uZGFyeUZpbmRjb250cm9sbGVyPzogYm9vbGVhbjtcbn1cblxuaW50ZXJmYWNlIERyYXdDb250ZXh0IHtcbiAgY3R4OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQ7XG4gIGNhbnZhczogSFRNTENhbnZhc0VsZW1lbnQ7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUERGRXhwb3J0U2NhbGVGYWN0b3Ige1xuICB3aWR0aD86IG51bWJlcjtcbiAgaGVpZ2h0PzogbnVtYmVyO1xuICBzY2FsZT86IG51bWJlcjtcbn1cblxudHlwZSBEaXJlY3Rpb25UeXBlID0gJ2x0cicgfCAncnRsJyB8ICdib3RoJyB8IHVuZGVmaW5lZDtcblxuZXhwb3J0IGludGVyZmFjZSBQZGZJbWFnZVBhcmFtZXRlcnMge1xuICB1cmxPckRhdGFVcmw6IHN0cmluZztcbiAgcGFnZT86IG51bWJlcjtcbiAgbGVmdD86IG51bWJlciB8IHN0cmluZztcbiAgYm90dG9tPzogbnVtYmVyIHwgc3RyaW5nO1xuICByaWdodD86IG51bWJlciB8IHN0cmluZztcbiAgdG9wPzogbnVtYmVyIHwgc3RyaW5nO1xuICByb3RhdGlvbj86IDAgfCA5MCB8IDE4MCB8IDI3MDtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBMaW5lIHtcbiAgeDogbnVtYmVyO1xuICB5OiBudW1iZXI7XG4gIHdpZHRoOiBudW1iZXI7XG4gIGhlaWdodDogbnVtYmVyO1xuICBkaXJlY3Rpb246IERpcmVjdGlvblR5cGU7XG4gIHRleHQ6IHN0cmluZztcbn1cbmV4cG9ydCBpbnRlcmZhY2UgU2VjdGlvbiB7XG4gIHg6IG51bWJlcjtcbiAgeTogbnVtYmVyO1xuICB3aWR0aDogbnVtYmVyO1xuICBoZWlnaHQ6IG51bWJlcjtcbiAgZGlyZWN0aW9uOiBEaXJlY3Rpb25UeXBlO1xuICBsaW5lczogQXJyYXk8TGluZT47XG59XG5cbkBJbmplY3RhYmxlKHtcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnLFxufSlcbmV4cG9ydCBjbGFzcyBOZ3hFeHRlbmRlZFBkZlZpZXdlclNlcnZpY2Uge1xuICBwdWJsaWMgbmd4RXh0ZW5kZWRQZGZWaWV3ZXJJbml0aWFsaXplZCA9IGZhbHNlO1xuXG4gIHB1YmxpYyBzZWNvbmRhcnlNZW51SXNFbXB0eSA9IGZhbHNlO1xuXG4gIHByaXZhdGUgcmVhZG9ubHkgcmVuZGVyZXI6IFJlbmRlcmVyMjtcbiAgcHJpdmF0ZSBQREZWaWV3ZXJBcHBsaWNhdGlvbj86IElQREZWaWV3ZXJBcHBsaWNhdGlvbjtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHJlYWRvbmx5IHJlbmRlcmVyRmFjdG9yeTogUmVuZGVyZXJGYWN0b3J5MixcbiAgICBub3RpZmljYXRpb25TZXJ2aWNlOiBQREZOb3RpZmljYXRpb25TZXJ2aWNlLFxuICApIHtcbiAgICB0aGlzLnJlbmRlcmVyID0gdGhpcy5yZW5kZXJlckZhY3RvcnkuY3JlYXRlUmVuZGVyZXIobnVsbCwgbnVsbCk7XG4gICAgZWZmZWN0KCgpID0+IHtcbiAgICAgIHRoaXMuUERGVmlld2VyQXBwbGljYXRpb24gPSBub3RpZmljYXRpb25TZXJ2aWNlLm9uUERGSlNJbml0U2lnbmFsKCk7XG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgZmluZCh0ZXh0OiBzdHJpbmcgfCBzdHJpbmdbXSB8IFJlZ0V4cCwgb3B0aW9uczogRmluZE9wdGlvbnMgPSB7fSk6IEFycmF5PFByb21pc2U8bnVtYmVyPj4gfCB1bmRlZmluZWQge1xuICAgIGlmICghdGhpcy5uZ3hFeHRlbmRlZFBkZlZpZXdlckluaXRpYWxpemVkKSB7XG4gICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6cXVvdGVtYXJrXG4gICAgICBjb25zb2xlLmVycm9yKFwiVGhlIFBERiB2aWV3ZXIgaGFzbid0IGZpbmlzaGVkIGluaXRpYWxpemluZy4gUGxlYXNlIGNhbGwgZmluZCgpIGxhdGVyLlwiKTtcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICghb3B0aW9ucy51c2VTZWNvbmRhcnlGaW5kY29udHJvbGxlcikge1xuICAgICAgICBjb25zdCBoaWdobGlnaHRBbGxDaGVja2JveCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaW5kSGlnaGxpZ2h0QWxsJykgYXMgSFRNTElucHV0RWxlbWVudDtcbiAgICAgICAgaWYgKGhpZ2hsaWdodEFsbENoZWNrYm94KSB7XG4gICAgICAgICAgaGlnaGxpZ2h0QWxsQ2hlY2tib3guY2hlY2tlZCA9IG9wdGlvbnMuaGlnaGxpZ2h0QWxsID8/IGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgbWF0Y2hDYXNlQ2hlY2tib3ggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmluZE1hdGNoQ2FzZScpIGFzIEhUTUxJbnB1dEVsZW1lbnQ7XG4gICAgICAgIGlmIChtYXRjaENhc2VDaGVja2JveCkge1xuICAgICAgICAgIG1hdGNoQ2FzZUNoZWNrYm94LmNoZWNrZWQgPSBvcHRpb25zLm1hdGNoQ2FzZSA/PyBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGZpbmRNdWx0aXBsZUNoZWNrYm94ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbmRNdWx0aXBsZScpIGFzIEhUTUxJbnB1dEVsZW1lbnQ7XG4gICAgICAgIGlmIChmaW5kTXVsdGlwbGVDaGVja2JveCkge1xuICAgICAgICAgIGZpbmRNdWx0aXBsZUNoZWNrYm94LmNoZWNrZWQgPSBvcHRpb25zLmZpbmRNdWx0aXBsZSA/PyBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGVudGlyZVdvcmRDaGVja2JveCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaW5kRW50aXJlV29yZCcpIGFzIEhUTUxJbnB1dEVsZW1lbnQ7XG4gICAgICAgIGlmIChlbnRpcmVXb3JkQ2hlY2tib3gpIHtcbiAgICAgICAgICBlbnRpcmVXb3JkQ2hlY2tib3guY2hlY2tlZCA9IG9wdGlvbnMud2hvbGVXb3JkcyA/PyBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IG1hdGNoRGlhY3JpdGljc0NoZWNrYm94ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbmRNYXRjaERpYWNyaXRpY3MnKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xuICAgICAgICBpZiAobWF0Y2hEaWFjcml0aWNzQ2hlY2tib3gpIHtcbiAgICAgICAgICBtYXRjaERpYWNyaXRpY3NDaGVja2JveC5jaGVja2VkID0gb3B0aW9ucy5tYXRjaERpYWNyaXRpY3MgPz8gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBtYXRjaFJlZ0V4cENoZWNrYm94ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hdGNoUmVnRXhwJykgYXMgSFRNTElucHV0RWxlbWVudDtcbiAgICAgICAgaWYgKG1hdGNoUmVnRXhwQ2hlY2tib3gpIHtcbiAgICAgICAgICBtYXRjaFJlZ0V4cENoZWNrYm94LmNoZWNrZWQgPSBvcHRpb25zLnJlZ2V4cCA/PyBmYWxzZTtcbiAgICAgICAgICBpZiAobWF0Y2hSZWdFeHBDaGVja2JveC5jaGVja2VkKSB7XG4gICAgICAgICAgICBpZiAoZmluZE11bHRpcGxlQ2hlY2tib3gpIHtcbiAgICAgICAgICAgICAgZmluZE11bHRpcGxlQ2hlY2tib3guY2hlY2tlZCA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGVudGlyZVdvcmRDaGVja2JveCkge1xuICAgICAgICAgICAgICBlbnRpcmVXb3JkQ2hlY2tib3guY2hlY2tlZCA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAobWF0Y2hEaWFjcml0aWNzQ2hlY2tib3gpIHtcbiAgICAgICAgICAgICAgbWF0Y2hEaWFjcml0aWNzQ2hlY2tib3guY2hlY2tlZCA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoZmluZE11bHRpcGxlQ2hlY2tib3gpIHtcbiAgICAgICAgICAgIGZpbmRNdWx0aXBsZUNoZWNrYm94LmRpc2FibGVkID0gbWF0Y2hSZWdFeHBDaGVja2JveC5jaGVja2VkO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoZW50aXJlV29yZENoZWNrYm94KSB7XG4gICAgICAgICAgICBlbnRpcmVXb3JkQ2hlY2tib3guZGlzYWJsZWQgPSBtYXRjaFJlZ0V4cENoZWNrYm94LmNoZWNrZWQ7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKG1hdGNoRGlhY3JpdGljc0NoZWNrYm94KSB7XG4gICAgICAgICAgICBtYXRjaERpYWNyaXRpY3NDaGVja2JveC5kaXNhYmxlZCA9IG1hdGNoUmVnRXhwQ2hlY2tib3guY2hlY2tlZDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBpbnB1dEZpZWxkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbmRJbnB1dCcpIGFzIEhUTUxJbnB1dEVsZW1lbnQ7XG4gICAgICAgIGlmIChpbnB1dEZpZWxkICYmIHR5cGVvZiB0ZXh0ID09PSAnc3RyaW5nJykge1xuICAgICAgICAgIGlucHV0RmllbGQudmFsdWUgPSB0ZXh0O1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGZpbmRQYXJhbWV0ZXJzOiBQREZGaW5kUGFyYW1ldGVycyA9IHtcbiAgICAgICAgY2FzZVNlbnNpdGl2ZTogb3B0aW9ucy5tYXRjaENhc2UgPz8gZmFsc2UsXG4gICAgICAgIGVudGlyZVdvcmQ6IG9wdGlvbnMud2hvbGVXb3JkcyA/PyBmYWxzZSxcbiAgICAgICAgaGlnaGxpZ2h0QWxsOiBvcHRpb25zLmhpZ2hsaWdodEFsbCA/PyBmYWxzZSxcbiAgICAgICAgbWF0Y2hEaWFjcml0aWNzOiBvcHRpb25zLm1hdGNoRGlhY3JpdGljcyA/PyBmYWxzZSxcbiAgICAgICAgZmluZE11bHRpcGxlOiBvcHRpb25zLmZpbmRNdWx0aXBsZSxcbiAgICAgICAgbWF0Y2hSZWdFeHA6IG9wdGlvbnMucmVnZXhwID8/IGZhbHNlLFxuICAgICAgICBmaW5kUHJldmlvdXM6IGZhbHNlLFxuICAgICAgICBxdWVyeTogdGV4dCxcbiAgICAgICAgc291cmNlOiBudWxsLFxuICAgICAgICB0eXBlOiAnZmluZCcsXG4gICAgICAgIGRvbnRTY3JvbGxJbnRvVmlldzogb3B0aW9ucy5kb250U2Nyb2xsSW50b1ZpZXcgPz8gZmFsc2UsXG4gICAgICB9O1xuICAgICAgY29uc3QgZmluZENvbnRyb2xsZXIgPSBvcHRpb25zLnVzZVNlY29uZGFyeUZpbmRjb250cm9sbGVyID8gdGhpcy5QREZWaWV3ZXJBcHBsaWNhdGlvbj8uY3VzdG9tRmluZENvbnRyb2xsZXIgOiB0aGlzLlBERlZpZXdlckFwcGxpY2F0aW9uPy5maW5kQ29udHJvbGxlcjtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGZpbmRDb250cm9sbGVyPy5uZ3hGaW5kKGZpbmRQYXJhbWV0ZXJzKTtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGZpbmROZXh0KHVzZVNlY29uZGFyeUZpbmRjb250cm9sbGVyOiBib29sZWFuID0gZmFsc2UpOiBib29sZWFuIHtcbiAgICBpZiAoIXRoaXMubmd4RXh0ZW5kZWRQZGZWaWV3ZXJJbml0aWFsaXplZCkge1xuICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOnF1b3RlbWFya1xuICAgICAgY29uc29sZS5lcnJvcihcIlRoZSBQREYgdmlld2VyIGhhc24ndCBmaW5pc2hlZCBpbml0aWFsaXppbmcuIFBsZWFzZSBjYWxsIGZpbmROZXh0KCkgbGF0ZXIuXCIpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBmaW5kQ29udHJvbGxlciA9IHVzZVNlY29uZGFyeUZpbmRjb250cm9sbGVyID8gdGhpcy5QREZWaWV3ZXJBcHBsaWNhdGlvbj8uY3VzdG9tRmluZENvbnRyb2xsZXIgOiB0aGlzLlBERlZpZXdlckFwcGxpY2F0aW9uPy5maW5kQ29udHJvbGxlcjtcbiAgICAgIGZpbmRDb250cm9sbGVyPy5uZ3hGaW5kTmV4dCgpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGZpbmRQcmV2aW91cyh1c2VTZWNvbmRhcnlGaW5kY29udHJvbGxlcjogYm9vbGVhbiA9IGZhbHNlKTogYm9vbGVhbiB7XG4gICAgaWYgKCF0aGlzLm5neEV4dGVuZGVkUGRmVmlld2VySW5pdGlhbGl6ZWQpIHtcbiAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpxdW90ZW1hcmtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJUaGUgUERGIHZpZXdlciBoYXNuJ3QgZmluaXNoZWQgaW5pdGlhbGl6aW5nLiBQbGVhc2UgY2FsbCBmaW5kUHJldmlvdXMoKSBsYXRlci5cIik7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IGZpbmRDb250cm9sbGVyID0gdXNlU2Vjb25kYXJ5RmluZGNvbnRyb2xsZXIgPyB0aGlzLlBERlZpZXdlckFwcGxpY2F0aW9uPy5jdXN0b21GaW5kQ29udHJvbGxlciA6IHRoaXMuUERGVmlld2VyQXBwbGljYXRpb24/LmZpbmRDb250cm9sbGVyO1xuICAgICAgZmluZENvbnRyb2xsZXI/Lm5neEZpbmRQcmV2aW91cygpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIHByaW50KHByaW50UmFuZ2U/OiBQREZQcmludFJhbmdlKSB7XG4gICAgaWYgKHRoaXMuUERGVmlld2VyQXBwbGljYXRpb24pIHtcbiAgICAgIGNvbnN0IGFscmVhZHlQcmludGluZyA9IHRoaXMuUERGVmlld2VyQXBwbGljYXRpb24/LlBERlByaW50U2VydmljZUZhY3Rvcnk/LmlzSW5QREZQcmludFJhbmdlICE9PSB1bmRlZmluZWQ7XG4gICAgICBpZiAoIWFscmVhZHlQcmludGluZykge1xuICAgICAgICAvLyBzbG93IGRvd24gaHVycmllZCB1c2VycyBjbGlja2luZyB0aGUgcHJpbnQgYnV0dG9uIG11bHRpcGxlIHRpbWVzXG4gICAgICAgIGlmICghcHJpbnRSYW5nZSkge1xuICAgICAgICAgIHByaW50UmFuZ2UgPSB7fSBhcyBQREZQcmludFJhbmdlO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2V0UHJpbnRSYW5nZShwcmludFJhbmdlKTtcbiAgICAgICAgdGhpcy5QREZWaWV3ZXJBcHBsaWNhdGlvbj8ucHJpbnRQZGYoKTtcbiAgICAgICAgdGhpcy5QREZWaWV3ZXJBcHBsaWNhdGlvbj8uZXZlbnRCdXMub24oJ2FmdGVycHJpbnQnLCB0aGlzLnJlbW92ZVByaW50UmFuZ2UuYmluZCh0aGlzKSwgeyBvbmNlOiB0cnVlIH0pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyByZW1vdmVQcmludFJhbmdlKCkge1xuICAgIGlmICh0aGlzLlBERlZpZXdlckFwcGxpY2F0aW9uPy5QREZQcmludFNlcnZpY2VGYWN0b3J5KSB7XG4gICAgICBkZWxldGUgdGhpcy5QREZWaWV3ZXJBcHBsaWNhdGlvbi5QREZQcmludFNlcnZpY2VGYWN0b3J5LmlzSW5QREZQcmludFJhbmdlO1xuICAgICAgZGVsZXRlIHRoaXMuUERGVmlld2VyQXBwbGljYXRpb24uUERGUHJpbnRTZXJ2aWNlRmFjdG9yeS5maWx0ZXJlZFBhZ2VDb3VudDtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgc2V0UHJpbnRSYW5nZShwcmludFJhbmdlOiBQREZQcmludFJhbmdlKSB7XG4gICAgaWYgKCF0aGlzLlBERlZpZXdlckFwcGxpY2F0aW9uPy5QREZQcmludFNlcnZpY2VGYWN0b3J5KSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiVGhlIHByaW50IHNlcnZpY2UgaGFzbid0IGJlZW4gaW5pdGlhbGl6ZWQgeWV0LlwiKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLlBERlZpZXdlckFwcGxpY2F0aW9uLlBERlByaW50U2VydmljZUZhY3RvcnkuaXNJblBERlByaW50UmFuZ2UgPSAocGFnZTogbnVtYmVyKSA9PiB0aGlzLmlzSW5QREZQcmludFJhbmdlKHBhZ2UsIHByaW50UmFuZ2UpO1xuICAgIHRoaXMuUERGVmlld2VyQXBwbGljYXRpb24uUERGUHJpbnRTZXJ2aWNlRmFjdG9yeS5maWx0ZXJlZFBhZ2VDb3VudCA9IHRoaXMuZmlsdGVyZWRQYWdlQ291bnQodGhpcy5QREZWaWV3ZXJBcHBsaWNhdGlvbj8ucGFnZXNDb3VudCwgcHJpbnRSYW5nZSk7XG4gIH1cblxuICBwdWJsaWMgZmlsdGVyZWRQYWdlQ291bnQocGFnZUNvdW50OiBudW1iZXIsIHJhbmdlOiBQREZQcmludFJhbmdlKTogbnVtYmVyIHtcbiAgICBsZXQgcmVzdWx0ID0gMDtcbiAgICBmb3IgKGxldCBwYWdlID0gMDsgcGFnZSA8IHBhZ2VDb3VudDsgcGFnZSsrKSB7XG4gICAgICBpZiAodGhpcy5pc0luUERGUHJpbnRSYW5nZShwYWdlLCByYW5nZSkpIHtcbiAgICAgICAgcmVzdWx0Kys7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICBwdWJsaWMgaXNJblBERlByaW50UmFuZ2UocGFnZUluZGV4OiBudW1iZXIsIHByaW50UmFuZ2U6IFBERlByaW50UmFuZ2UpIHtcbiAgICBjb25zdCBwYWdlID0gcGFnZUluZGV4ICsgMTtcbiAgICBpZiAocHJpbnRSYW5nZS5mcm9tKSB7XG4gICAgICBpZiAocGFnZSA8IHByaW50UmFuZ2UuZnJvbSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChwcmludFJhbmdlLnRvKSB7XG4gICAgICBpZiAocGFnZSA+IHByaW50UmFuZ2UudG8pIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAocHJpbnRSYW5nZS5leGNsdWRlZCkge1xuICAgICAgaWYgKHByaW50UmFuZ2UuZXhjbHVkZWQuc29tZSgocCkgPT4gcCA9PT0gcGFnZSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAocHJpbnRSYW5nZS5pbmNsdWRlZCkge1xuICAgICAgaWYgKCFwcmludFJhbmdlLmluY2x1ZGVkLnNvbWUoKHApID0+IHAgPT09IHBhZ2UpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgZ2V0UGFnZUFzTGluZXMocGFnZU51bWJlcjogbnVtYmVyKTogUHJvbWlzZTxBcnJheTxMaW5lPj4ge1xuICAgIGlmICh0aGlzLlBERlZpZXdlckFwcGxpY2F0aW9uKSB7XG4gICAgICBjb25zdCBwZGZEb2N1bWVudCA9IHRoaXMuUERGVmlld2VyQXBwbGljYXRpb24/LnBkZkRvY3VtZW50O1xuXG4gICAgICBjb25zdCBwYWdlID0gYXdhaXQgcGRmRG9jdW1lbnQuZ2V0UGFnZShwYWdlTnVtYmVyKTtcbiAgICAgIGNvbnN0IHRleHRTbmlwcGV0cyA9IChhd2FpdCBwYWdlLmdldFRleHRDb250ZW50KCkpLml0ZW1zIC8vXG4gICAgICAgIC5maWx0ZXIoKGluZm8pID0+ICFpbmZvWyd0eXBlJ10pOyAvLyBpZ25vcmUgdGhlIFRleHRNYXJrZWRDb250ZW50IGl0ZW1zXG5cbiAgICAgIGNvbnN0IHNuaXBwZXRzID0gdGV4dFNuaXBwZXRzIGFzIEFycmF5PFRleHRJdGVtPjtcblxuICAgICAgbGV0IG1pblggPSBOdW1iZXIuTUFYX1NBRkVfSU5URUdFUjtcbiAgICAgIGxldCBtaW5ZID0gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVI7XG4gICAgICBsZXQgbWF4WCA9IE51bWJlci5NSU5fU0FGRV9JTlRFR0VSO1xuICAgICAgbGV0IG1heFkgPSBOdW1iZXIuTUlOX1NBRkVfSU5URUdFUjtcbiAgICAgIGxldCBjb3VudExUUiA9IDA7XG4gICAgICBsZXQgY291bnRSVEwgPSAwO1xuICAgICAgbGV0IHRleHQgPSAnJztcbiAgICAgIGxldCBsaW5lcyA9IG5ldyBBcnJheTxMaW5lPigpO1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzbmlwcGV0cy5sZW5ndGg7IGkrKykge1xuICAgICAgICBjb25zdCBjdXJyZW50U25pcHBldCA9IHNuaXBwZXRzW2ldO1xuICAgICAgICAvLyAjMzA2NSBtb2RpZmllZCBieSBuZ3gtZXh0ZW5kZWQtcGRmLXZpZXdlclxuICAgICAgICAvLyBBbHdheXMgcHJvY2VzcyB0aGUgY3VycmVudCBzbmlwcGV0J3MgdGV4dCBhbmQgYm91bmRzLCByZWdhcmRsZXNzIG9mIGhhc0VPTFxuICAgICAgICBjb25zdCB4ID0gY3VycmVudFNuaXBwZXQudHJhbnNmb3JtWzRdO1xuICAgICAgICBjb25zdCB5ID0gLWN1cnJlbnRTbmlwcGV0LnRyYW5zZm9ybVs1XTtcbiAgICAgICAgY29uc3Qgd2lkdGggPSBjdXJyZW50U25pcHBldC53aWR0aDtcbiAgICAgICAgY29uc3QgaGVpZ2h0ID0gY3VycmVudFNuaXBwZXQuaGVpZ2h0O1xuICAgICAgICBtaW5YID0gTWF0aC5taW4obWluWCwgeCk7XG4gICAgICAgIG1pblkgPSBNYXRoLm1pbihtaW5ZLCB5KTtcbiAgICAgICAgbWF4WCA9IE1hdGgubWF4KG1heFgsIHggKyB3aWR0aCk7XG4gICAgICAgIG1heFkgPSBNYXRoLm1heChtYXhZLCB5ICsgaGVpZ2h0KTtcbiAgICAgICAgdGV4dCArPSBjdXJyZW50U25pcHBldC5zdHI7XG4gICAgICAgIGlmIChjdXJyZW50U25pcHBldC5kaXIgPT09ICdydGwnKSB7XG4gICAgICAgICAgY291bnRSVEwrKztcbiAgICAgICAgfVxuICAgICAgICBpZiAoY3VycmVudFNuaXBwZXQuZGlyID09PSAnbHRyJykge1xuICAgICAgICAgIGNvdW50TFRSKys7XG4gICAgICAgIH1cbiAgICAgICAgLy8gIzMwNjUgZW5kIG9mIG1vZGlmaWNhdGlvbiBieSBuZ3gtZXh0ZW5kZWQtcGRmLXZpZXdlclxuXG4gICAgICAgIGxldCBhZGRJdCA9IGkgPT09IHNuaXBwZXRzLmxlbmd0aCAtIDEgfHwgY3VycmVudFNuaXBwZXQuaGFzRU9MO1xuICAgICAgICBpZiAoYWRkSXQpIHtcbiAgICAgICAgICBsZXQgZGlyZWN0aW9uOiBEaXJlY3Rpb25UeXBlID0gdW5kZWZpbmVkO1xuICAgICAgICAgIGlmIChjb3VudExUUiA+IDAgJiYgY291bnRSVEwgPiAwKSB7XG4gICAgICAgICAgICBkaXJlY3Rpb24gPSAnYm90aCc7XG4gICAgICAgICAgfSBlbHNlIGlmIChjb3VudExUUiA+IDApIHtcbiAgICAgICAgICAgIGRpcmVjdGlvbiA9ICdsdHInO1xuICAgICAgICAgIH0gZWxzZSBpZiAoY291bnRSVEwgPiAwKSB7XG4gICAgICAgICAgICBkaXJlY3Rpb24gPSAncnRsJztcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc3QgbGluZSA9IHtcbiAgICAgICAgICAgIGRpcmVjdGlvbixcbiAgICAgICAgICAgIHg6IG1pblgsXG4gICAgICAgICAgICB5OiBtaW5ZLFxuICAgICAgICAgICAgd2lkdGg6IG1heFggLSBtaW5YLFxuICAgICAgICAgICAgaGVpZ2h0OiBtYXhZIC0gbWluWSxcbiAgICAgICAgICAgIHRleHQ6IHRleHQudHJpbSgpLFxuICAgICAgICAgIH0gYXMgTGluZTtcbiAgICAgICAgICBsaW5lcy5wdXNoKGxpbmUpO1xuICAgICAgICAgIG1pblggPSBOdW1iZXIuTUFYX1NBRkVfSU5URUdFUjtcbiAgICAgICAgICBtaW5ZID0gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVI7XG4gICAgICAgICAgbWF4WCA9IE51bWJlci5NSU5fU0FGRV9JTlRFR0VSO1xuICAgICAgICAgIG1heFkgPSBOdW1iZXIuTUlOX1NBRkVfSU5URUdFUjtcbiAgICAgICAgICBjb3VudExUUiA9IDA7XG4gICAgICAgICAgY291bnRSVEwgPSAwO1xuICAgICAgICAgIHRleHQgPSAnJztcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIGxpbmVzO1xuICAgIH1cbiAgICByZXR1cm4gW107XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgZ2V0UGFnZUFzVGV4dChwYWdlTnVtYmVyOiBudW1iZXIpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGlmICghdGhpcy5QREZWaWV3ZXJBcHBsaWNhdGlvbikge1xuICAgICAgcmV0dXJuICcnO1xuICAgIH1cbiAgICBjb25zdCBwZGZEb2N1bWVudCA9IHRoaXMuUERGVmlld2VyQXBwbGljYXRpb24/LnBkZkRvY3VtZW50O1xuXG4gICAgY29uc3QgcGFnZSA9IGF3YWl0IHBkZkRvY3VtZW50LmdldFBhZ2UocGFnZU51bWJlcik7XG4gICAgY29uc3QgdGV4dFNuaXBwZXRzID0gKGF3YWl0IHBhZ2UuZ2V0VGV4dENvbnRlbnQoKSkuaXRlbXM7XG4gICAgcmV0dXJuIHRoaXMuY29udmVydFRleHRJbmZvVG9UZXh0KHRleHRTbmlwcGV0cyk7XG4gIH1cblxuICBwcml2YXRlIGNvbnZlcnRUZXh0SW5mb1RvVGV4dCh0ZXh0SW5mb0l0ZW1zOiBBcnJheTxUZXh0SXRlbSB8IFRleHRNYXJrZWRDb250ZW50Pik6IHN0cmluZyB7XG4gICAgaWYgKCF0ZXh0SW5mb0l0ZW1zKSB7XG4gICAgICByZXR1cm4gJyc7XG4gICAgfVxuICAgIHJldHVybiB0ZXh0SW5mb0l0ZW1zXG4gICAgICAuZmlsdGVyKChpbmZvKSA9PiAhaW5mb1sndHlwZSddKVxuICAgICAgLm1hcCgoaW5mbzogVGV4dEl0ZW0pID0+IChpbmZvLmhhc0VPTCA/IGluZm8uc3RyICsgJ1xcbicgOiBpbmZvLnN0cikpXG4gICAgICAuam9pbignJyk7XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgZ2V0UGFnZUFzQ2FudmFzKFxuICAgIHBhZ2VOdW1iZXI6IG51bWJlcixcbiAgICBzY2FsZTogUERGRXhwb3J0U2NhbGVGYWN0b3IsXG4gICAgYmFja2dyb3VuZD86IHN0cmluZyxcbiAgICBiYWNrZ3JvdW5kQ29sb3JUb1JlcGxhY2U6IHN0cmluZyA9ICcjRkZGRkZGJyxcbiAgICBhbm5vdGF0aW9uTW9kZTogQW5ub3RhdGlvbk1vZGUgPSBBbm5vdGF0aW9uTW9kZS5FTkFCTEUsXG4gICk6IFByb21pc2U8SFRNTENhbnZhc0VsZW1lbnQgfCB1bmRlZmluZWQ+IHtcbiAgICBpZiAoIXRoaXMuUERGVmlld2VyQXBwbGljYXRpb24pIHtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUodW5kZWZpbmVkKTtcbiAgICB9XG4gICAgY29uc3QgcGRmRG9jdW1lbnQgPSB0aGlzLlBERlZpZXdlckFwcGxpY2F0aW9uLnBkZkRvY3VtZW50O1xuICAgIGNvbnN0IHBkZlBhZ2UgPSBhd2FpdCBwZGZEb2N1bWVudC5nZXRQYWdlKHBhZ2VOdW1iZXIpO1xuICAgIHJldHVybiB0aGlzLmRyYXcocGRmUGFnZSwgc2NhbGUsIGJhY2tncm91bmQsIGJhY2tncm91bmRDb2xvclRvUmVwbGFjZSwgYW5ub3RhdGlvbk1vZGUpO1xuICB9XG5cbiAgcHVibGljIGFzeW5jIGdldFBhZ2VBc0ltYWdlKFxuICAgIHBhZ2VOdW1iZXI6IG51bWJlcixcbiAgICBzY2FsZTogUERGRXhwb3J0U2NhbGVGYWN0b3IsXG4gICAgYmFja2dyb3VuZD86IHN0cmluZyxcbiAgICBiYWNrZ3JvdW5kQ29sb3JUb1JlcGxhY2U6IHN0cmluZyA9ICcjRkZGRkZGJyxcbiAgICBhbm5vdGF0aW9uTW9kZTogQW5ub3RhdGlvbk1vZGUgPSBBbm5vdGF0aW9uTW9kZS5FTkFCTEUsXG4gICk6IFByb21pc2U8c3RyaW5nIHwgdW5kZWZpbmVkPiB7XG4gICAgY29uc3QgY2FudmFzID0gYXdhaXQgdGhpcy5nZXRQYWdlQXNDYW52YXMocGFnZU51bWJlciwgc2NhbGUsIGJhY2tncm91bmQsIGJhY2tncm91bmRDb2xvclRvUmVwbGFjZSwgYW5ub3RhdGlvbk1vZGUpO1xuICAgIHJldHVybiBjYW52YXM/LnRvRGF0YVVSTCgpO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBkcmF3KFxuICAgIHBkZlBhZ2U6IFBERlBhZ2VQcm94eSxcbiAgICBzY2FsZTogUERGRXhwb3J0U2NhbGVGYWN0b3IsXG4gICAgYmFja2dyb3VuZD86IHN0cmluZyxcbiAgICBiYWNrZ3JvdW5kQ29sb3JUb1JlcGxhY2U6IHN0cmluZyA9ICcjRkZGRkZGJyxcbiAgICBhbm5vdGF0aW9uTW9kZTogQW5ub3RhdGlvbk1vZGUgPSBBbm5vdGF0aW9uTW9kZS5FTkFCTEUsXG4gICk6IFByb21pc2U8SFRNTENhbnZhc0VsZW1lbnQ+IHtcbiAgICBsZXQgem9vbUZhY3RvciA9IDE7XG4gICAgaWYgKHNjYWxlLnNjYWxlKSB7XG4gICAgICB6b29tRmFjdG9yID0gc2NhbGUuc2NhbGU7XG4gICAgfSBlbHNlIGlmIChzY2FsZS53aWR0aCkge1xuICAgICAgem9vbUZhY3RvciA9IHNjYWxlLndpZHRoIC8gcGRmUGFnZS5nZXRWaWV3cG9ydCh7IHNjYWxlOiAxIH0pLndpZHRoO1xuICAgIH0gZWxzZSBpZiAoc2NhbGUuaGVpZ2h0KSB7XG4gICAgICB6b29tRmFjdG9yID0gc2NhbGUuaGVpZ2h0IC8gcGRmUGFnZS5nZXRWaWV3cG9ydCh7IHNjYWxlOiAxIH0pLmhlaWdodDtcbiAgICB9XG4gICAgY29uc3Qgdmlld3BvcnQgPSBwZGZQYWdlLmdldFZpZXdwb3J0KHtcbiAgICAgIHNjYWxlOiB6b29tRmFjdG9yLFxuICAgIH0pO1xuICAgIGNvbnN0IHsgY3R4LCBjYW52YXMgfSA9IHRoaXMuZ2V0UGFnZURyYXdDb250ZXh0KHZpZXdwb3J0LndpZHRoLCB2aWV3cG9ydC5oZWlnaHQpO1xuICAgIGNvbnN0IGRyYXdWaWV3cG9ydCA9IHZpZXdwb3J0LmNsb25lKCk7XG5cbiAgICBjb25zdCByZW5kZXJDb250ZXh0ID0ge1xuICAgICAgY2FudmFzQ29udGV4dDogY3R4LFxuICAgICAgdmlld3BvcnQ6IGRyYXdWaWV3cG9ydCxcbiAgICAgIGJhY2tncm91bmQsXG4gICAgICBiYWNrZ3JvdW5kQ29sb3JUb1JlcGxhY2UsXG4gICAgICBhbm5vdGF0aW9uTW9kZSxcbiAgICB9O1xuICAgIGNvbnN0IHJlbmRlclRhc2sgPSBwZGZQYWdlLnJlbmRlcihyZW5kZXJDb250ZXh0KTtcblxuICAgIGNvbnN0IGRhdGFVcmxQcm9taXNlID0gKCkgPT4gUHJvbWlzZS5yZXNvbHZlKGNhbnZhcyk7XG5cbiAgICByZXR1cm4gcmVuZGVyVGFzay5wcm9taXNlLnRoZW4oZGF0YVVybFByb21pc2UpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRQYWdlRHJhd0NvbnRleHQod2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIpOiBEcmF3Q29udGV4dCB7XG4gICAgY29uc3QgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7XG4gICAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJywgeyBhbHBoYTogdHJ1ZSB9KTtcbiAgICBpZiAoIWN0eCkge1xuICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBxdW90ZW1hcmtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkNvdWxkbid0IGNyZWF0ZSB0aGUgMmQgY29udGV4dFwiKTtcbiAgICB9XG5cbiAgICBjYW52YXMud2lkdGggPSB3aWR0aDtcbiAgICBjYW52YXMuaGVpZ2h0ID0gaGVpZ2h0O1xuICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUoY2FudmFzLCAnd2lkdGgnLCBgJHt3aWR0aH1weGApO1xuICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUoY2FudmFzLCAnaGVpZ2h0JywgYCR7aGVpZ2h0fXB4YCk7XG5cbiAgICByZXR1cm4geyBjdHgsIGNhbnZhcyB9O1xuICB9XG5cbiAgcHVibGljIGFzeW5jIGdldEN1cnJlbnREb2N1bWVudEFzQmxvYigpOiBQcm9taXNlPEJsb2IgfCB1bmRlZmluZWQ+IHtcbiAgICByZXR1cm4gKGF3YWl0IHRoaXMuUERGVmlld2VyQXBwbGljYXRpb24/LmV4cG9ydCgpKSB8fCB1bmRlZmluZWQ7XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgZ2V0Rm9ybURhdGEoY3VycmVudEZvcm1WYWx1ZXMgPSB0cnVlKTogUHJvbWlzZTxBcnJheTxPYmplY3Q+PiB7XG4gICAgaWYgKCF0aGlzLlBERlZpZXdlckFwcGxpY2F0aW9uKSB7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuICAgIGNvbnN0IHBkZjogUERGRG9jdW1lbnRQcm94eSB8IHVuZGVmaW5lZCA9IHRoaXMuUERGVmlld2VyQXBwbGljYXRpb24/LnBkZkRvY3VtZW50O1xuICAgIC8vIHNjcmVlbiBEUEkgLyBQREYgRFBJXG4gICAgY29uc3QgZHBpUmF0aW8gPSA5NiAvIDcyO1xuICAgIGNvbnN0IHJlc3VsdDogQXJyYXk8T2JqZWN0PiA9IFtdO1xuICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IHBkZj8ubnVtUGFnZXM7IGkrKykge1xuICAgICAgLy8gdHJhY2sgdGhlIGN1cnJlbnQgcGFnZVxuICAgICAgY29uc3QgY3VycmVudFBhZ2UgLyogOiBQREZQYWdlUHJveHkgKi8gPSBhd2FpdCBwZGYuZ2V0UGFnZShpKTtcbiAgICAgIGNvbnN0IGFubm90YXRpb25zID0gYXdhaXQgY3VycmVudFBhZ2UuZ2V0QW5ub3RhdGlvbnMoKTtcblxuICAgICAgYW5ub3RhdGlvbnNcbiAgICAgICAgLmZpbHRlcigoYSkgPT4gYS5zdWJ0eXBlID09PSAnV2lkZ2V0JykgLy8gZ2V0IHRoZSBmb3JtIGZpZWxkIGFubm90YXRpb25zIG9ubHlcbiAgICAgICAgLm1hcCgoYSkgPT4gKHsgLi4uYSB9KSkgLy8gb25seSBleHBvc2UgY29waWVzIG9mIHRoZSBhbm5vdGF0aW9ucyB0byBhdm9pZCBzaWRlLWVmZmVjdHNcbiAgICAgICAgLmZvckVhY2goKGEpID0+IHtcbiAgICAgICAgICAvLyBnZXQgdGhlIHJlY3RhbmdsZSB0aGF0IHJlcHJlc2VudCB0aGUgc2luZ2xlIGZpZWxkXG4gICAgICAgICAgLy8gYW5kIHJlc2l6ZSBpdCBhY2NvcmRpbmcgdG8gdGhlIGN1cnJlbnQgRFBJXG4gICAgICAgICAgY29uc3QgZmllbGRSZWN0OiBBcnJheTxudW1iZXI+ID0gY3VycmVudFBhZ2UuZ2V0Vmlld3BvcnQoeyBzY2FsZTogZHBpUmF0aW8gfSkuY29udmVydFRvVmlld3BvcnRSZWN0YW5nbGUoYS5yZWN0KTtcblxuICAgICAgICAgIC8vIGFkZCB0aGUgY29ycmVzcG9uZGluZyBpbnB1dFxuICAgICAgICAgIGlmIChjdXJyZW50Rm9ybVZhbHVlcyAmJiBhLmZpZWxkTmFtZSkge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgaWYgKGEuZXhwb3J0VmFsdWUpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50VmFsdWU6IGFueSA9IHRoaXMuUERGVmlld2VyQXBwbGljYXRpb24/LnBkZkRvY3VtZW50LmFubm90YXRpb25TdG9yYWdlLmdldFZhbHVlKGEuaWQsIGEuZmllbGROYW1lICsgJy8nICsgYS5leHBvcnRWYWx1ZSwgJycpO1xuICAgICAgICAgICAgICAgIGEudmFsdWUgPSBjdXJyZW50VmFsdWU/LnZhbHVlO1xuICAgICAgICAgICAgICB9IGVsc2UgaWYgKGEucmFkaW9CdXR0b24pIHtcbiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50VmFsdWU6IGFueSA9IHRoaXMuUERGVmlld2VyQXBwbGljYXRpb24/LnBkZkRvY3VtZW50LmFubm90YXRpb25TdG9yYWdlLmdldFZhbHVlKGEuaWQsIGEuZmllbGROYW1lICsgJy8nICsgYS5maWVsZFZhbHVlLCAnJyk7XG4gICAgICAgICAgICAgICAgYS52YWx1ZSA9IGN1cnJlbnRWYWx1ZT8udmFsdWU7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc3QgY3VycmVudFZhbHVlOiBhbnkgPSB0aGlzLlBERlZpZXdlckFwcGxpY2F0aW9uPy5wZGZEb2N1bWVudC5hbm5vdGF0aW9uU3RvcmFnZS5nZXRWYWx1ZShhLmlkLCBhLmZpZWxkTmFtZSwgJycpO1xuICAgICAgICAgICAgICAgIGEudmFsdWUgPSBjdXJyZW50VmFsdWU/LnZhbHVlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGNhdGNoIChleGNlcHRpb24pIHtcbiAgICAgICAgICAgICAgLy8ganVzdCBpZ25vcmUgaXRcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgcmVzdWx0LnB1c2goeyBmaWVsZEFubm90YXRpb246IGEsIGZpZWxkUmVjdCwgcGFnZU51bWJlcjogaSB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICAvKipcbiAgICogQWRkcyBhIHBhZ2UgdG8gdGhlIHJlbmRlcmluZyBxdWV1ZVxuICAgKiBAcGFyYW0ge251bWJlcn0gcGFnZUluZGV4IEluZGV4IG9mIHRoZSBwYWdlIHRvIHJlbmRlclxuICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gZmFsc2UsIGlmIHRoZSBwYWdlIGhhcyBhbHJlYWR5IGJlZW4gcmVuZGVyZWQsXG4gICAqIGlmIGl0J3Mgb3V0IG9mIHJhbmdlIG9yIGlmIHRoZSB2aWV3ZXIgaGFzbid0IGJlZW4gaW5pdGlhbGl6ZWQgeWV0XG4gICAqL1xuICBwdWJsaWMgYWRkUGFnZVRvUmVuZGVyUXVldWUocGFnZUluZGV4OiBudW1iZXIpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5QREZWaWV3ZXJBcHBsaWNhdGlvbj8ucGRmVmlld2VyLmFkZFBhZ2VUb1JlbmRlclF1ZXVlKHBhZ2VJbmRleCkgPz8gZmFsc2U7XG4gIH1cblxuICBwdWJsaWMgaXNSZW5kZXJRdWV1ZUVtcHR5KCk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IHNjcm9sbGVkRG93biA9IHRydWU7XG4gICAgY29uc3QgcmVuZGVyRXh0cmEgPSBmYWxzZTtcbiAgICBpZiAodGhpcy5QREZWaWV3ZXJBcHBsaWNhdGlvbikge1xuICAgICAgY29uc3QgbmV4dFBhZ2UgPSB0aGlzLlBERlZpZXdlckFwcGxpY2F0aW9uLnBkZlZpZXdlci5yZW5kZXJpbmdRdWV1ZS5nZXRIaWdoZXN0UHJpb3JpdHkoXG4gICAgICAgIHRoaXMuUERGVmlld2VyQXBwbGljYXRpb24/LnBkZlZpZXdlci5fZ2V0VmlzaWJsZVBhZ2VzKCksXG4gICAgICAgIHRoaXMuUERGVmlld2VyQXBwbGljYXRpb24/LnBkZlZpZXdlci5fcGFnZXMsXG4gICAgICAgIHNjcm9sbGVkRG93bixcbiAgICAgICAgcmVuZGVyRXh0cmEsXG4gICAgICApO1xuICAgICAgcmV0dXJuICFuZXh0UGFnZTtcbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBwdWJsaWMgaGFzUGFnZUJlZW5SZW5kZXJlZChwYWdlSW5kZXg6IG51bWJlcik6IGJvb2xlYW4ge1xuICAgIGlmICghdGhpcy5QREZWaWV3ZXJBcHBsaWNhdGlvbikge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25zdCBwYWdlcyA9IHRoaXMuUERGVmlld2VyQXBwbGljYXRpb24/LnBkZlZpZXdlci5fcGFnZXM7XG4gICAgaWYgKHBhZ2VzLmxlbmd0aCA+IHBhZ2VJbmRleCAmJiBwYWdlSW5kZXggPj0gMCkge1xuICAgICAgY29uc3QgcGFnZVZpZXcgPSBwYWdlc1twYWdlSW5kZXhdO1xuICAgICAgY29uc3QgaGFzQmVlblJlbmRlcmVkID0gcGFnZVZpZXcucmVuZGVyaW5nU3RhdGUgPT09IDM7XG4gICAgICByZXR1cm4gaGFzQmVlblJlbmRlcmVkO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBwcml2YXRlIHNsZWVwKG1zOiBudW1iZXIpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgbXMpKTtcbiAgfVxuXG4gIHB1YmxpYyBhc3luYyByZW5kZXJQYWdlKHBhZ2VJbmRleDogbnVtYmVyKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgaWYgKCF0aGlzLmhhc1BhZ2VCZWVuUmVuZGVyZWQocGFnZUluZGV4KSkge1xuICAgICAgYXdhaXQgdGhpcy5hZGRQYWdlVG9SZW5kZXJRdWV1ZShwYWdlSW5kZXgpO1xuICAgICAgd2hpbGUgKCF0aGlzLmhhc1BhZ2VCZWVuUmVuZGVyZWQocGFnZUluZGV4KSkge1xuICAgICAgICBhd2FpdCB0aGlzLnNsZWVwKDcpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBjdXJyZW50bHlSZW5kZXJlZFBhZ2VzKCk6IEFycmF5PG51bWJlcj4ge1xuICAgIGlmICghdGhpcy5QREZWaWV3ZXJBcHBsaWNhdGlvbikge1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgICBjb25zdCBwYWdlcyA9IHRoaXMuUERGVmlld2VyQXBwbGljYXRpb24/LnBkZlZpZXdlci5fcGFnZXM7XG4gICAgcmV0dXJuIHBhZ2VzLmZpbHRlcigocGFnZSkgPT4gcGFnZS5yZW5kZXJpbmdTdGF0ZSA9PT0gMykubWFwKChwYWdlKSA9PiBwYWdlLmlkKTtcbiAgfVxuXG4gIHB1YmxpYyBudW1iZXJPZlBhZ2VzKCk6IG51bWJlciB7XG4gICAgaWYgKCF0aGlzLlBERlZpZXdlckFwcGxpY2F0aW9uKSB7XG4gICAgICByZXR1cm4gMDtcbiAgICB9XG4gICAgY29uc3QgcGFnZXMgPSB0aGlzLlBERlZpZXdlckFwcGxpY2F0aW9uPy5wZGZWaWV3ZXIuX3BhZ2VzO1xuICAgIHJldHVybiBwYWdlcy5sZW5ndGg7XG4gIH1cblxuICBwdWJsaWMgZ2V0Q3VycmVudGx5VmlzaWJsZVBhZ2VOdW1iZXJzKCk6IEFycmF5PG51bWJlcj4ge1xuICAgIGNvbnN0IGFwcCA9IHRoaXMuUERGVmlld2VyQXBwbGljYXRpb247XG4gICAgaWYgKCFhcHApIHtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gICAgY29uc3QgcGFnZXMgPSAoYXBwLnBkZlZpZXdlci5fZ2V0VmlzaWJsZVBhZ2VzKCkgYXMgYW55KS52aWV3cyBhcyBBcnJheTxhbnk+O1xuICAgIHJldHVybiBwYWdlcz8ubWFwKChwYWdlKSA9PiBwYWdlLmlkKTtcbiAgfVxuXG4gIHB1YmxpYyBhc3luYyBsaXN0TGF5ZXJzKCk6IFByb21pc2U8QXJyYXk8UGRmTGF5ZXI+IHwgdW5kZWZpbmVkPiB7XG4gICAgaWYgKCF0aGlzLlBERlZpZXdlckFwcGxpY2F0aW9uKSB7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuXG4gICAgY29uc3Qgb3B0aW9uYWxDb250ZW50Q29uZmlnID0gYXdhaXQgdGhpcy5QREZWaWV3ZXJBcHBsaWNhdGlvbj8ucGRmVmlld2VyLm9wdGlvbmFsQ29udGVudENvbmZpZ1Byb21pc2U7XG4gICAgaWYgKG9wdGlvbmFsQ29udGVudENvbmZpZykge1xuICAgICAgY29uc3QgbGV2ZWxEYXRhID0gb3B0aW9uYWxDb250ZW50Q29uZmlnLmdldE9yZGVyKCk7XG4gICAgICBjb25zdCBsYXllcklkcyA9IGxldmVsRGF0YS5maWx0ZXIoKGdyb3VwSWQpID0+IHR5cGVvZiBncm91cElkICE9PSAnb2JqZWN0Jyk7XG4gICAgICByZXR1cm4gbGF5ZXJJZHMubWFwKChsYXllcklkKSA9PiB7XG4gICAgICAgIGNvbnN0IGNvbmZpZyA9IG9wdGlvbmFsQ29udGVudENvbmZpZy5nZXRHcm91cChsYXllcklkKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBsYXllcklkOiBsYXllcklkLFxuICAgICAgICAgIG5hbWU6IGNvbmZpZy5uYW1lLFxuICAgICAgICAgIHZpc2libGU6IGNvbmZpZy52aXNpYmxlLFxuICAgICAgICB9IGFzIFBkZkxheWVyO1xuICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgdG9nZ2xlTGF5ZXIobGF5ZXJJZDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgaWYgKCF0aGlzLlBERlZpZXdlckFwcGxpY2F0aW9uKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IG9wdGlvbmFsQ29udGVudENvbmZpZyA9IGF3YWl0IHRoaXMuUERGVmlld2VyQXBwbGljYXRpb24/LnBkZlZpZXdlci5vcHRpb25hbENvbnRlbnRDb25maWdQcm9taXNlO1xuICAgIGlmIChvcHRpb25hbENvbnRlbnRDb25maWcpIHtcbiAgICAgIGxldCBpc1Zpc2libGUgPSBvcHRpb25hbENvbnRlbnRDb25maWcuZ2V0R3JvdXAobGF5ZXJJZCkudmlzaWJsZTtcbiAgICAgIGNvbnN0IGNoZWNrYm94ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgaW5wdXRbaWQ9JyR7bGF5ZXJJZH0nXWApO1xuICAgICAgaWYgKGNoZWNrYm94KSB7XG4gICAgICAgIGlzVmlzaWJsZSA9IChjaGVja2JveCBhcyBIVE1MSW5wdXRFbGVtZW50KS5jaGVja2VkO1xuICAgICAgICAoY2hlY2tib3ggYXMgSFRNTElucHV0RWxlbWVudCkuY2hlY2tlZCA9ICFpc1Zpc2libGU7XG4gICAgICB9XG4gICAgICBvcHRpb25hbENvbnRlbnRDb25maWcuc2V0VmlzaWJpbGl0eShsYXllcklkLCAhaXNWaXNpYmxlKTtcbiAgICAgIHRoaXMuUERGVmlld2VyQXBwbGljYXRpb24/LmV2ZW50QnVzLmRpc3BhdGNoKCdvcHRpb25hbGNvbnRlbnRjb25maWcnLCB7XG4gICAgICAgIHNvdXJjZTogdGhpcyxcbiAgICAgICAgcHJvbWlzZTogUHJvbWlzZS5yZXNvbHZlKG9wdGlvbmFsQ29udGVudENvbmZpZyksXG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgc2Nyb2xsUGFnZUludG9WaWV3KHBhZ2VOdW1iZXI6IG51bWJlciwgcGFnZVNwb3Q/OiB7IHRvcD86IG51bWJlciB8IHN0cmluZzsgbGVmdD86IG51bWJlciB8IHN0cmluZyB9KTogdm9pZCB7XG4gICAgY29uc3Qgdmlld2VyID0gdGhpcy5QREZWaWV3ZXJBcHBsaWNhdGlvbj8ucGRmVmlld2VyIGFzIGFueTtcbiAgICB2aWV3ZXI/LnNjcm9sbFBhZ2VQb3NJbnRvVmlldyhwYWdlTnVtYmVyLCBwYWdlU3BvdCk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyBhbGwgZWRpdG9yIGFubm90YXRpb25zIChkcmF3aW5ncywgdGV4dCwgaW1hZ2VzLCBoaWdobGlnaHRzKSBpbiBzZXJpYWxpemVkIGZvcm1hdC5cbiAgICpcbiAgICogKipJTVBPUlRBTlQgLSBJRCBCZWhhdmlvcjoqKlxuICAgKiAtIEVhY2ggYW5ub3RhdGlvbiBpbmNsdWRlcyBhbiBgaWRgIGZpZWxkIGZvciByZWFsLXRpbWUgZXZlbnQgdHJhY2tpbmcgdmlhIGBhbm5vdGF0aW9uRWRpdG9yRXZlbnRgXG4gICAqIC0gV2hlbiByZS1hcHBseWluZyBhbm5vdGF0aW9ucyB1c2luZyBgYWRkRWRpdG9yQW5ub3RhdGlvbigpYCwgKipuZXcgSURzIGFyZSBhbHdheXMgYXNzaWduZWQqKlxuICAgKiAtIElEcyBhcmUgKipub3QgcGVyc2lzdGVudCoqIGFjcm9zcyBzZXNzaW9ucyAtIHRoZXkgYXJlIHRlbXBvcmFyeSBpZGVudGlmaWVyc1xuICAgKiAtIElmIHlvdSBuZWVkIHRvIHN0b3JlIGFubm90YXRpb25zIGZvciBsYXRlciB1c2UsIHlvdSBjYW4gc2FmZWx5ICoqb21pdCB0aGUgYGlkYCBmaWVsZCoqXG4gICAqXG4gICAqICoqRXhhbXBsZSAtIFN0b3JpbmcgYW5kIFJlLWFwcGx5aW5nIEFubm90YXRpb25zOioqXG4gICAqIGBgYHR5cGVzY3JpcHRcbiAgICogLy8gU2F2ZSBhbm5vdGF0aW9ucyAoSURzIGFyZSBvcHRpb25hbCB0byBzdG9yZSlcbiAgICogY29uc3QgYW5ub3RhdGlvbnMgPSBwZGZTZXJ2aWNlLmdldFNlcmlhbGl6ZWRBbm5vdGF0aW9ucygpO1xuICAgKiBjb25zdCB0b1N0b3JlID0gYW5ub3RhdGlvbnMubWFwKCh7IGlkLCAuLi5yZXN0IH0pID0+IHJlc3QpOyAvLyBSZW1vdmUgSURzXG4gICAqIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdhbm5vdGF0aW9ucycsIEpTT04uc3RyaW5naWZ5KHRvU3RvcmUpKTtcbiAgICpcbiAgICogLy8gUmUtYXBwbHkgYW5ub3RhdGlvbnMgKG5ldyBJRHMgd2lsbCBiZSBhc3NpZ25lZCBhdXRvbWF0aWNhbGx5KVxuICAgKiBjb25zdCBzdG9yZWQgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdhbm5vdGF0aW9ucycpKTtcbiAgICogYXdhaXQgcGRmU2VydmljZS5hZGRFZGl0b3JBbm5vdGF0aW9uKHN0b3JlZCk7XG4gICAqIGBgYFxuICAgKlxuICAgKiBAcmV0dXJucyBBcnJheSBvZiBzZXJpYWxpemVkIGFubm90YXRpb25zIHdpdGggdGVtcG9yYXJ5IElEcywgb3IgbnVsbCBpZiBubyBhbm5vdGF0aW9ucyBleGlzdFxuICAgKi9cbiAgcHVibGljIGdldFNlcmlhbGl6ZWRBbm5vdGF0aW9ucygpOiBFZGl0b3JBbm5vdGF0aW9uW10gfCBudWxsIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5QREZWaWV3ZXJBcHBsaWNhdGlvbj8ucGRmVmlld2VyLmdldFNlcmlhbGl6ZWRBbm5vdGF0aW9ucygpO1xuICB9XG5cbiAgLy8gIzMwNzYgYWRkZWQgYnkgbmd4LWV4dGVuZGVkLXBkZi12aWV3ZXJcbiAgLyoqXG4gICAqIFJldHVybnMgYSBzaW5nbGUgZWRpdG9yIGFubm90YXRpb24gYnkgaXRzIElELlxuICAgKlxuICAgKiAqKklNUE9SVEFOVCAtIElEIEJlaGF2aW9yOioqXG4gICAqIC0gSURzIGFyZSB0ZW1wb3JhcnkgYW5kIG9ubHkgdmFsaWQgZHVyaW5nIHRoZSBjdXJyZW50IHNlc3Npb25cbiAgICogLSBVc2VmdWwgZm9yIHJlc3BvbmRpbmcgdG8gYGFubm90YXRpb25FZGl0b3JFdmVudGAgZXZlbnRzXG4gICAqIC0gRG8gbm90IHJlbHkgb24gSURzIHRvIHBlcnNpc3QgYWNyb3NzIGRvY3VtZW50IHJlbG9hZHMgb3Igc2Vzc2lvbnNcbiAgICpcbiAgICogQHBhcmFtIGlkIFRoZSB0ZW1wb3JhcnkgdW5pcXVlIGlkZW50aWZpZXIgb2YgdGhlIGFubm90YXRpb24gKGZyb20gYGFubm90YXRpb25FZGl0b3JFdmVudGAgb3IgYGdldFNlcmlhbGl6ZWRBbm5vdGF0aW9ucygpYClcbiAgICogQHJldHVybnMgVGhlIHNlcmlhbGl6ZWQgYW5ub3RhdGlvbiBtYXRjaGluZyB0aGUgSUQsIG9yIG51bGwgaWYgbm90IGZvdW5kXG4gICAqL1xuICBwdWJsaWMgZ2V0U2VyaWFsaXplZEFubm90YXRpb24oaWQ6IHN0cmluZyk6IEVkaXRvckFubm90YXRpb24gfCBudWxsIHwgdW5kZWZpbmVkIHtcbiAgICBjb25zdCBhbm5vdGF0aW9ucyA9IHRoaXMuUERGVmlld2VyQXBwbGljYXRpb24/LnBkZlZpZXdlci5nZXRTZXJpYWxpemVkQW5ub3RhdGlvbnMoKTtcbiAgICBpZiAoIWFubm90YXRpb25zIHx8ICFBcnJheS5pc0FycmF5KGFubm90YXRpb25zKSkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIHJldHVybiBhbm5vdGF0aW9ucy5maW5kKChhbm5vdGF0aW9uKSA9PiBhbm5vdGF0aW9uLmlkID09PSBpZCkgfHwgbnVsbDtcbiAgfVxuICAvLyAjMzA3NiBlbmQgb2YgbW9kaWZpY2F0aW9uIGJ5IG5neC1leHRlbmRlZC1wZGYtdmlld2VyXG5cbiAgLyoqXG4gICAqIFByb2dyYW1tYXRpY2FsbHkgYWRkcyBvbmUgb3IgbW9yZSBlZGl0b3IgYW5ub3RhdGlvbnMgdG8gdGhlIFBERi5cbiAgICpcbiAgICogKipJTVBPUlRBTlQgLSBJRCBCZWhhdmlvcjoqKlxuICAgKiAtIEFueSBgaWRgIGZpZWxkcyBpbiB0aGUgcHJvdmlkZWQgYW5ub3RhdGlvbnMgYXJlICoqaWdub3JlZCoqXG4gICAqIC0gTmV3IHVuaXF1ZSBJRHMgYXJlIGFsd2F5cyBhc3NpZ25lZCBhdXRvbWF0aWNhbGx5XG4gICAqIC0gVGhpcyBlbnN1cmVzIG5vIElEIGNvbmZsaWN0cyBvY2N1clxuICAgKiAtIFRoZSBgaWRgIGZpZWxkIGlzIG9wdGlvbmFsIHdoZW4gY2FsbGluZyB0aGlzIG1ldGhvZFxuICAgKlxuICAgKiAqKlN1cHBvcnRlZCBBbm5vdGF0aW9uIFR5cGVzOioqXG4gICAqIC0gSW5rIChkcmF3aW5ncylcbiAgICogLSBGcmVlVGV4dCAodGV4dCBib3hlcylcbiAgICogLSBTdGFtcCAoaW1hZ2VzKVxuICAgKiAtIEhpZ2hsaWdodFxuICAgKiAtIFBvcHVwIChjb21tZW50cylcbiAgICpcbiAgICogQHBhcmFtIHNlcmlhbGl6ZWRBbm5vdGF0aW9uIEEgc2luZ2xlIGFubm90YXRpb24gb2JqZWN0LCBhcnJheSBvZiBhbm5vdGF0aW9ucywgb3IgSlNPTiBzdHJpbmdcbiAgICogQHJldHVybnMgUHJvbWlzZSB0aGF0IHJlc29sdmVzIHdoZW4gdGhlIGFubm90YXRpb24ocykgaGF2ZSBiZWVuIGFkZGVkXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIC8vIEFkZCBhIHNpbmdsZSBhbm5vdGF0aW9uICh3aXRoIG9yIHdpdGhvdXQgSUQgLSBib3RoIHdvcmsgdGhlIHNhbWUpXG4gICAqIGF3YWl0IHBkZlNlcnZpY2UuYWRkRWRpdG9yQW5ub3RhdGlvbih7XG4gICAqICAgYW5ub3RhdGlvblR5cGU6IDMsXG4gICAqICAgY29sb3I6IFsyNTUsIDAsIDBdLFxuICAgKiAgIHZhbHVlOiAnSGVsbG8nLFxuICAgKiAgIHBhZ2VJbmRleDogMCxcbiAgICogICByZWN0OiBbMTAwLCAxMDAsIDIwMCwgMTUwXSxcbiAgICogICByb3RhdGlvbjogMFxuICAgKiAgIC8vIGlkIGZpZWxkIGlzIG9wdGlvbmFsIGFuZCB3aWxsIGJlIGlnbm9yZWQgaWYgcHJvdmlkZWRcbiAgICogfSk7XG4gICAqL1xuICBwdWJsaWMgYXN5bmMgYWRkRWRpdG9yQW5ub3RhdGlvbihzZXJpYWxpemVkQW5ub3RhdGlvbjogc3RyaW5nIHwgRWRpdG9yQW5ub3RhdGlvbik6IFByb21pc2U8dm9pZD4ge1xuICAgIC8vICMzMDYxIFdoZW4gdGhlIGVkaXRvciBtb2RlIGlzIE5PTkUsIFBERi5qcyBpbnRlcm5hbGx5IHN3aXRjaGVzIHRvIEZSRUVURVhUIG1vZGUgdGVtcG9yYXJpbHksXG4gICAgLy8gd2hpY2ggY2F1c2VzIHRoZSBGcmVlVGV4dCBwb3B1cCB0byBmbGFzaC4gUHJldmVudCB0aGlzIGJ5IGhpZGluZyB0aGUgcG9wdXAgZHVyaW5nIHRoZSBvcGVyYXRpb24uXG4gICAgY29uc3QgY3VycmVudE1vZGUgPSB0aGlzLlBERlZpZXdlckFwcGxpY2F0aW9uPy5wZGZWaWV3ZXIuYW5ub3RhdGlvbkVkaXRvck1vZGU7XG4gICAgY29uc3QgcG9wdXAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWRpdG9yRnJlZVRleHRQYXJhbXNUb29sYmFyJyk7XG4gICAgY29uc3Qgd2FzSGlkZGVuID0gcG9wdXA/LmNsYXNzTGlzdC5jb250YWlucygnaGlkZGVuJykgPz8gdHJ1ZTtcblxuICAgIC8vIElmIG1vZGUgaXMgTk9ORSBhbmQgcG9wdXAgd2FzIGhpZGRlbiwga2VlcCBpdCBoaWRkZW4gZHVyaW5nIHRoZSB0ZW1wb3JhcnkgbW9kZSBzd2l0Y2hcbiAgICBpZiAoY3VycmVudE1vZGUgPT09IDAgJiYgd2FzSGlkZGVuICYmIHBvcHVwKSB7XG4gICAgICB0aGlzLnJlbmRlcmVyLmFkZENsYXNzKHBvcHVwLCAnbmd4LWtlZXAtaGlkZGVuJyk7XG4gICAgfVxuXG4gICAgYXdhaXQgdGhpcy5QREZWaWV3ZXJBcHBsaWNhdGlvbj8ucGRmVmlld2VyLmFkZEVkaXRvckFubm90YXRpb24oc2VyaWFsaXplZEFubm90YXRpb24pO1xuXG4gICAgLy8gIzMwNjEgUmVtb3ZlIHRoZSB0ZW1wb3JhcnkgaGlkaW5nIGNsYXNzIGFmdGVyIHRoZSBvcGVyYXRpb25cbiAgICBpZiAoY3VycmVudE1vZGUgPT09IDAgJiYgd2FzSGlkZGVuICYmIHBvcHVwKSB7XG4gICAgICB0aGlzLnJlbmRlcmVyLnJlbW92ZUNsYXNzKHBvcHVwLCAnbmd4LWtlZXAtaGlkZGVuJyk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIHJlbW92ZUVkaXRvckFubm90YXRpb25zKGZpbHRlcj86IChzZXJpYWxpemVkOiBvYmplY3QpID0+IGJvb2xlYW4pOiB2b2lkIHtcbiAgICB0aGlzLlBERlZpZXdlckFwcGxpY2F0aW9uPy5wZGZWaWV3ZXIucmVtb3ZlRWRpdG9yQW5ub3RhdGlvbnMoZmlsdGVyKTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgbG9hZEltYWdlQXNEYXRhVVJMKGltYWdlVXJsOiBzdHJpbmcpOiBQcm9taXNlPEJsb2IgfCBzdHJpbmc+IHtcbiAgICBpZiAoaW1hZ2VVcmwuc3RhcnRzV2l0aCgnZGF0YTonKSkge1xuICAgICAgcmV0dXJuIGltYWdlVXJsO1xuICAgIH1cbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGltYWdlVXJsKTtcbiAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBmZXRjaCB0aGUgaW1hZ2UgZnJvbSAke2ltYWdlVXJsfTogJHtyZXNwb25zZS5zdGF0dXNUZXh0fWApO1xuICAgIH1cblxuICAgIGNvbnN0IGltYWdlQmxvYiA9IGF3YWl0IHJlc3BvbnNlLmJsb2IoKTtcbiAgICByZXR1cm4gaW1hZ2VCbG9iO1xuICB9XG5cbiAgcHVibGljIGFzeW5jIGFkZEltYWdlVG9Bbm5vdGF0aW9uTGF5ZXIoeyB1cmxPckRhdGFVcmwsIHBhZ2UsIGxlZnQsIGJvdHRvbSwgcmlnaHQsIHRvcCwgcm90YXRpb24gfTogUGRmSW1hZ2VQYXJhbWV0ZXJzKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgaWYgKCF0aGlzLlBERlZpZXdlckFwcGxpY2F0aW9uKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdUaGUgUERGIHZpZXdlciBoYXMgbm90IGJlZW4gaW5pdGlhbGl6ZWQgeWV0LicpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBsZXQgcGFnZVRvTW9kaWZ5OiBudW1iZXI7XG4gICAgaWYgKHBhZ2UgIT09IHVuZGVmaW5lZCkge1xuICAgICAgaWYgKHBhZ2UgIT09IHRoaXMuY3VycmVudFBhZ2VJbmRleCgpKSB7XG4gICAgICAgIGF3YWl0IHRoaXMucmVuZGVyUGFnZShwYWdlKTtcbiAgICAgIH1cbiAgICAgIHBhZ2VUb01vZGlmeSA9IHBhZ2U7XG4gICAgfSBlbHNlIHtcbiAgICAgIHBhZ2VUb01vZGlmeSA9IHRoaXMuY3VycmVudFBhZ2VJbmRleCgpID8/IDA7XG4gICAgfVxuICAgIGNvbnN0IHByZXZpb3VzQW5ub3RhdGlvbkVkaXRvck1vZGUgPSB0aGlzLlBERlZpZXdlckFwcGxpY2F0aW9uLnBkZlZpZXdlci5hbm5vdGF0aW9uRWRpdG9yTW9kZTtcblxuICAgIC8vICMzMDYxIENoZWNrIGlmIHRoZSBzdGFtcCBwb3B1cCBpcyBjdXJyZW50bHkgaGlkZGVuIHRvIHByZXZlbnQgZmxhc2hpbmdcbiAgICBjb25zdCBwb3B1cCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlZGl0b3JTdGFtcFBhcmFtc1Rvb2xiYXInKTtcbiAgICBjb25zdCB3YXNIaWRkZW4gPSBwb3B1cD8uY2xhc3NMaXN0LmNvbnRhaW5zKCdoaWRkZW4nKSA/PyB0cnVlO1xuXG4gICAgLy8gSWYgdGhlIHBvcHVwIHdhcyBoaWRkZW4sIGFkZCBhIENTUyBjbGFzcyB0byBrZWVwIGl0IGhpZGRlbiBkdXJpbmcgbW9kZSBzd2l0Y2hcbiAgICBpZiAod2FzSGlkZGVuICYmIHBvcHVwKSB7XG4gICAgICB0aGlzLnJlbmRlcmVyLmFkZENsYXNzKHBvcHVwLCAnbmd4LWtlZXAtaGlkZGVuJyk7XG4gICAgfVxuXG4gICAgdGhpcy5zd2l0Y2hBbm5vdGF0aW9uRWR0b3JNb2RlKDEzKTtcbiAgICBjb25zdCBkYXRhVXJsID0gYXdhaXQgdGhpcy5sb2FkSW1hZ2VBc0RhdGFVUkwodXJsT3JEYXRhVXJsKTtcbiAgICBjb25zdCBwYWdlU2l6ZSA9IHRoaXMuUERGVmlld2VyQXBwbGljYXRpb24ucGRmVmlld2VyLl9wYWdlc1twYWdlVG9Nb2RpZnldLnBkZlBhZ2UudmlldztcbiAgICBjb25zdCBsZWZ0RGltID0gcGFnZVNpemVbMF07XG4gICAgY29uc3QgYm90dG9tRGltID0gcGFnZVNpemVbMV07XG4gICAgY29uc3QgcmlnaHREaW0gPSBwYWdlU2l6ZVsyXTtcbiAgICBjb25zdCB0b3BEaW0gPSBwYWdlU2l6ZVszXTtcbiAgICBjb25zdCB3aWR0aCA9IHJpZ2h0RGltIC0gbGVmdERpbTtcbiAgICBjb25zdCBoZWlnaHQgPSB0b3BEaW0gLSBib3R0b21EaW07XG4gICAgY29uc3QgaW1hZ2VXaWR0aCA9IHRoaXMuUERGVmlld2VyQXBwbGljYXRpb24/LnBkZlZpZXdlci5fcGFnZXNbcGFnZVRvTW9kaWZ5XS5kaXYuY2xpZW50V2lkdGg7XG4gICAgY29uc3QgaW1hZ2VIZWlnaHQgPSB0aGlzLlBERlZpZXdlckFwcGxpY2F0aW9uPy5wZGZWaWV3ZXIuX3BhZ2VzW3BhZ2VUb01vZGlmeV0uZGl2LmNsaWVudEhlaWdodDtcbiAgICBjb25zdCBsZWZ0UGRmID0gdGhpcy5jb252ZXJ0VG9QREZDb29yZGluYXRlcyhsZWZ0LCB3aWR0aCwgMCwgaW1hZ2VXaWR0aCk7XG4gICAgY29uc3QgYm90dG9tUGRmID0gdGhpcy5jb252ZXJ0VG9QREZDb29yZGluYXRlcyhib3R0b20sIGhlaWdodCwgMCwgaW1hZ2VIZWlnaHQpO1xuICAgIGNvbnN0IHJpZ2h0UGRmID0gdGhpcy5jb252ZXJ0VG9QREZDb29yZGluYXRlcyhyaWdodCwgd2lkdGgsIHdpZHRoLCBpbWFnZVdpZHRoKTtcbiAgICBjb25zdCB0b3BQZGYgPSB0aGlzLmNvbnZlcnRUb1BERkNvb3JkaW5hdGVzKHRvcCwgaGVpZ2h0LCBoZWlnaHQsIGltYWdlSGVpZ2h0KTtcblxuICAgIGNvbnN0IHN0YW1wQW5ub3RhdGlvbjogU3RhbXBFZGl0b3JBbm5vdGF0aW9uID0ge1xuICAgICAgYW5ub3RhdGlvblR5cGU6IDEzLFxuICAgICAgcGFnZUluZGV4OiBwYWdlVG9Nb2RpZnksXG4gICAgICBiaXRtYXBVcmw6IGRhdGFVcmwsXG4gICAgICByZWN0OiBbbGVmdFBkZiwgYm90dG9tUGRmLCByaWdodFBkZiwgdG9wUGRmXSxcbiAgICAgIHJvdGF0aW9uOiByb3RhdGlvbiA/PyAwLFxuICAgICAgaXNDb3B5OiB0cnVlLFxuICAgIH07XG4gICAgdGhpcy5hZGRFZGl0b3JBbm5vdGF0aW9uKHN0YW1wQW5ub3RhdGlvbik7XG4gICAgYXdhaXQgdGhpcy5zbGVlcCgxMCk7XG4gICAgdGhpcy5zd2l0Y2hBbm5vdGF0aW9uRWR0b3JNb2RlKHByZXZpb3VzQW5ub3RhdGlvbkVkaXRvck1vZGUpO1xuXG4gICAgLy8gIzMwNjEgUmVtb3ZlIHRoZSB0ZW1wb3JhcnkgaGlkaW5nIGNsYXNzIGFmdGVyIHN3aXRjaGluZyBiYWNrXG4gICAgaWYgKHdhc0hpZGRlbiAmJiBwb3B1cCkge1xuICAgICAgdGhpcy5yZW5kZXJlci5yZW1vdmVDbGFzcyhwb3B1cCwgJ25neC1rZWVwLWhpZGRlbicpO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBhc3luYyBhZGRIaWdobGlnaHRUb0Fubm90YXRpb25MYXllcihcbiAgICBjb2xvcjogbnVtYmVyW10sXG4gICAgcGFnZTogbnVtYmVyIHwgdW5kZWZpbmVkLFxuICAgIGxlZnQ6IG51bWJlciB8IHN0cmluZyxcbiAgICBib3R0b206IG51bWJlciB8IHN0cmluZyxcbiAgICByaWdodDogbnVtYmVyIHwgc3RyaW5nLFxuICAgIHRvcDogbnVtYmVyIHwgc3RyaW5nLFxuICAgIHRoaWNrbmVzczogbnVtYmVyID0gMTIsXG4gICAgcm90YXRpb246IDAgfCA5MCB8IDE4MCB8IDI3MCA9IDAsXG4gICAgb3BhY2l0eTogbnVtYmVyID0gMC41LFxuICApOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAoIXRoaXMuUERGVmlld2VyQXBwbGljYXRpb24pIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1RoZSBQREYgdmlld2VyIGhhcyBub3QgYmVlbiBpbml0aWFsaXplZCB5ZXQuJyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgbGV0IHBhZ2VUb01vZGlmeTogbnVtYmVyO1xuICAgIGlmIChwYWdlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGlmIChwYWdlICE9PSB0aGlzLmN1cnJlbnRQYWdlSW5kZXgoKSkge1xuICAgICAgICBhd2FpdCB0aGlzLnJlbmRlclBhZ2UocGFnZSk7XG4gICAgICB9XG4gICAgICBwYWdlVG9Nb2RpZnkgPSBwYWdlO1xuICAgIH0gZWxzZSB7XG4gICAgICBwYWdlVG9Nb2RpZnkgPSB0aGlzLmN1cnJlbnRQYWdlSW5kZXgoKSA/PyAwO1xuICAgIH1cblxuICAgIGNvbnN0IHByZXZpb3VzQW5ub3RhdGlvbkVkaXRvck1vZGUgPSB0aGlzLlBERlZpZXdlckFwcGxpY2F0aW9uLnBkZlZpZXdlci5hbm5vdGF0aW9uRWRpdG9yTW9kZTtcblxuICAgIC8vICMzMDYxIENoZWNrIGlmIHRoZSBwb3B1cCBpcyBjdXJyZW50bHkgaGlkZGVuIHRvIHByZXZlbnQgZmxhc2hpbmdcbiAgICBjb25zdCBwb3B1cCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlZGl0b3JIaWdobGlnaHRQYXJhbXNUb29sYmFyJyk7XG4gICAgY29uc3Qgd2FzSGlkZGVuID0gcG9wdXA/LmNsYXNzTGlzdC5jb250YWlucygnaGlkZGVuJykgPz8gdHJ1ZTtcblxuICAgIC8vIElmIHRoZSBwb3B1cCB3YXMgaGlkZGVuLCBhZGQgYSBDU1MgY2xhc3MgdG8ga2VlcCBpdCBoaWRkZW4gZHVyaW5nIG1vZGUgc3dpdGNoXG4gICAgaWYgKHdhc0hpZGRlbiAmJiBwb3B1cCkge1xuICAgICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyhwb3B1cCwgJ25neC1rZWVwLWhpZGRlbicpO1xuICAgIH1cblxuICAgIHRoaXMuc3dpdGNoQW5ub3RhdGlvbkVkdG9yTW9kZSg5KTsgLy8gQW5ub3RhdGlvbkVkaXRvclR5cGUuSElHSExJR0hUXG5cbiAgICBjb25zdCBwYWdlU2l6ZSA9IHRoaXMuUERGVmlld2VyQXBwbGljYXRpb24ucGRmVmlld2VyLl9wYWdlc1twYWdlVG9Nb2RpZnldLnBkZlBhZ2UudmlldztcbiAgICBjb25zdCBsZWZ0RGltID0gcGFnZVNpemVbMF07XG4gICAgY29uc3QgYm90dG9tRGltID0gcGFnZVNpemVbMV07XG4gICAgY29uc3QgcmlnaHREaW0gPSBwYWdlU2l6ZVsyXTtcbiAgICBjb25zdCB0b3BEaW0gPSBwYWdlU2l6ZVszXTtcbiAgICBjb25zdCB3aWR0aCA9IHJpZ2h0RGltIC0gbGVmdERpbTtcbiAgICBjb25zdCBoZWlnaHQgPSB0b3BEaW0gLSBib3R0b21EaW07XG4gICAgY29uc3QgcGFnZVdpZHRoID0gdGhpcy5QREZWaWV3ZXJBcHBsaWNhdGlvbj8ucGRmVmlld2VyLl9wYWdlc1twYWdlVG9Nb2RpZnldLmRpdi5jbGllbnRXaWR0aDtcbiAgICBjb25zdCBwYWdlSGVpZ2h0ID0gdGhpcy5QREZWaWV3ZXJBcHBsaWNhdGlvbj8ucGRmVmlld2VyLl9wYWdlc1twYWdlVG9Nb2RpZnldLmRpdi5jbGllbnRIZWlnaHQ7XG5cbiAgICBjb25zdCBsZWZ0UGRmID0gdGhpcy5jb252ZXJ0VG9QREZDb29yZGluYXRlcyhsZWZ0LCB3aWR0aCwgMCwgcGFnZVdpZHRoKTtcbiAgICBjb25zdCBib3R0b21QZGYgPSB0aGlzLmNvbnZlcnRUb1BERkNvb3JkaW5hdGVzKGJvdHRvbSwgaGVpZ2h0LCAwLCBwYWdlSGVpZ2h0KTtcbiAgICBjb25zdCByaWdodFBkZiA9IHRoaXMuY29udmVydFRvUERGQ29vcmRpbmF0ZXMocmlnaHQsIHdpZHRoLCB3aWR0aCwgcGFnZVdpZHRoKTtcbiAgICBjb25zdCB0b3BQZGYgPSB0aGlzLmNvbnZlcnRUb1BERkNvb3JkaW5hdGVzKHRvcCwgaGVpZ2h0LCBoZWlnaHQsIHBhZ2VIZWlnaHQpO1xuXG4gICAgLy8gQ3JlYXRlIHF1YWRQb2ludHMgb2JqZWN0IHdpdGggbnVtZXJpYyBrZXlzIChtYXRjaGluZyBleHBvcnQgZm9ybWF0KVxuICAgIGNvbnN0IHF1YWRQb2ludHM6IGFueSA9IHt9O1xuICAgIHF1YWRQb2ludHNbMF0gPSBsZWZ0UGRmOyAvLyB4MSAtIGxlZnQgZWRnZSBzdGFydFxuICAgIHF1YWRQb2ludHNbMV0gPSB0b3BQZGY7IC8vIHkxIC0gdG9wIGVkZ2Ugc3RhcnRcbiAgICBxdWFkUG9pbnRzWzJdID0gcmlnaHRQZGY7IC8vIHgyIC0gcmlnaHQgZWRnZSBlbmRcbiAgICBxdWFkUG9pbnRzWzNdID0gdG9wUGRmOyAvLyB5MiAtIHRvcCBlZGdlIGVuZFxuICAgIHF1YWRQb2ludHNbNF0gPSBsZWZ0UGRmOyAvLyB4MyAtIGxlZnQgZWRnZSBzdGFydCAoYm90dG9tKVxuICAgIHF1YWRQb2ludHNbNV0gPSBib3R0b21QZGY7IC8vIHkzIC0gYm90dG9tIGVkZ2Ugc3RhcnRcbiAgICBxdWFkUG9pbnRzWzZdID0gcmlnaHRQZGY7IC8vIHg0IC0gcmlnaHQgZWRnZSBlbmQgKGJvdHRvbSlcbiAgICBxdWFkUG9pbnRzWzddID0gYm90dG9tUGRmOyAvLyB5NCAtIGJvdHRvbSBlZGdlIGVuZFxuXG4gICAgY29uc3QgaGlnaGxpZ2h0QW5ub3RhdGlvbjogSGlnaGxpZ2h0RWRpdG9yQW5ub3RhdGlvbiA9IHtcbiAgICAgIGFubm90YXRpb25UeXBlOiA5LFxuICAgICAgY29sb3I6IGNvbG9yLFxuICAgICAgb3BhY2l0eTogb3BhY2l0eSxcbiAgICAgIHRoaWNrbmVzczogdGhpY2tuZXNzLFxuICAgICAgcXVhZFBvaW50czogcXVhZFBvaW50cyxcbiAgICAgIG91dGxpbmVzOiBbXG4gICAgICAgIFtcbiAgICAgICAgICAvLyBTaW5nbGUgb3V0bGluZSByZWN0YW5nbGVcbiAgICAgICAgICBsZWZ0UGRmLFxuICAgICAgICAgIGJvdHRvbVBkZiwgLy8gQm90dG9tLWxlZnRcbiAgICAgICAgICBsZWZ0UGRmLFxuICAgICAgICAgIHRvcFBkZiwgLy8gVG9wLWxlZnRcbiAgICAgICAgICByaWdodFBkZixcbiAgICAgICAgICB0b3BQZGYsIC8vIFRvcC1yaWdodFxuICAgICAgICAgIHJpZ2h0UGRmLFxuICAgICAgICAgIGJvdHRvbVBkZiwgLy8gQm90dG9tLXJpZ2h0XG4gICAgICAgIF0sXG4gICAgICBdLFxuICAgICAgcGFnZUluZGV4OiBwYWdlVG9Nb2RpZnksXG4gICAgICByZWN0OiBbbGVmdFBkZiwgYm90dG9tUGRmLCByaWdodFBkZiwgdG9wUGRmXSxcbiAgICAgIHJvdGF0aW9uOiByb3RhdGlvbixcbiAgICAgIGlzQ29weTogdHJ1ZSxcbiAgICB9O1xuXG4gICAgdGhpcy5hZGRFZGl0b3JBbm5vdGF0aW9uKGhpZ2hsaWdodEFubm90YXRpb24pO1xuICAgIGF3YWl0IHRoaXMuc2xlZXAoMTApO1xuICAgIHRoaXMuc3dpdGNoQW5ub3RhdGlvbkVkdG9yTW9kZShwcmV2aW91c0Fubm90YXRpb25FZGl0b3JNb2RlKTtcblxuICAgIC8vICMzMDYxIFJlbW92ZSB0aGUgdGVtcG9yYXJ5IGhpZGluZyBjbGFzcyBhZnRlciBzd2l0Y2hpbmcgYmFja1xuICAgIGlmICh3YXNIaWRkZW4gJiYgcG9wdXApIHtcbiAgICAgIHRoaXMucmVuZGVyZXIucmVtb3ZlQ2xhc3MocG9wdXAsICduZ3gta2VlcC1oaWRkZW4nKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgY3VycmVudFBhZ2VJbmRleCgpOiBudW1iZXIgfCB1bmRlZmluZWQge1xuICAgIGNvbnN0IHZpZXdlciA9IHRoaXMuUERGVmlld2VyQXBwbGljYXRpb24/LnBkZlZpZXdlcjtcbiAgICBpZiAodmlld2VyKSB7XG4gICAgICByZXR1cm4gdmlld2VyLmN1cnJlbnRQYWdlTnVtYmVyIC0gMTtcbiAgICB9XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxuXG4gIHByaXZhdGUgY29udmVydFRvUERGQ29vcmRpbmF0ZXModmFsdWU6IFpvb21UeXBlLCBtYXhWYWx1ZTogbnVtYmVyLCBkZWZhdWx0VmFsdWU6IG51bWJlciwgaW1hZ2VNYXhWYWx1ZTogbnVtYmVyKTogbnVtYmVyIHtcbiAgICBpZiAoIXZhbHVlKSB7XG4gICAgICByZXR1cm4gZGVmYXVsdFZhbHVlO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgaWYgKHZhbHVlLmVuZHNXaXRoKCclJykpIHtcbiAgICAgICAgcmV0dXJuIChwYXJzZUludCh2YWx1ZSwgMTApIC8gMTAwKSAqIG1heFZhbHVlO1xuICAgICAgfSBlbHNlIGlmICh2YWx1ZS5lbmRzV2l0aCgncHgnKSkge1xuICAgICAgICByZXR1cm4gcGFyc2VJbnQodmFsdWUsIDEwKSAqIChtYXhWYWx1ZSAvIGltYWdlTWF4VmFsdWUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHBhcnNlSW50KHZhbHVlLCAxMCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB2YWx1ZTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgc3dpdGNoQW5ub3RhdGlvbkVkdG9yTW9kZShtb2RlOiBudW1iZXIpOiB2b2lkIHtcbiAgICB0aGlzLlBERlZpZXdlckFwcGxpY2F0aW9uPy5ldmVudEJ1cy5kaXNwYXRjaCgnc3dpdGNoYW5ub3RhdGlvbmVkaXRvcm1vZGUnLCB7IG1vZGUgfSk7XG4gIH1cblxuICBwdWJsaWMgc2V0IGVkaXRvckZvbnRTaXplKHNpemU6IG51bWJlcikge1xuICAgIHRoaXMuc2V0RWRpdG9yUHJvcGVydHkoQW5ub3RhdGlvbkVkaXRvclBhcmFtc1R5cGUuRlJFRVRFWFRfU0laRSwgc2l6ZSk7XG4gIH1cblxuICBwdWJsaWMgc2V0IGVkaXRvckZvbnRDb2xvcihjb2xvcjogc3RyaW5nKSB7XG4gICAgdGhpcy5zZXRFZGl0b3JQcm9wZXJ0eShBbm5vdGF0aW9uRWRpdG9yUGFyYW1zVHlwZS5GUkVFVEVYVF9DT0xPUiwgY29sb3IpO1xuICB9XG5cbiAgcHVibGljIHNldCBlZGl0b3JJbmtDb2xvcihjb2xvcjogc3RyaW5nKSB7XG4gICAgdGhpcy5zZXRFZGl0b3JQcm9wZXJ0eShBbm5vdGF0aW9uRWRpdG9yUGFyYW1zVHlwZS5JTktfQ09MT1IsIGNvbG9yKTtcbiAgfVxuXG4gIHB1YmxpYyBzZXQgZWRpdG9ySW5rT3BhY2l0eShvcGFjaXR5OiBudW1iZXIpIHtcbiAgICB0aGlzLnNldEVkaXRvclByb3BlcnR5KEFubm90YXRpb25FZGl0b3JQYXJhbXNUeXBlLklOS19PUEFDSVRZLCBvcGFjaXR5KTtcbiAgfVxuXG4gIHB1YmxpYyBzZXQgZWRpdG9ySW5rVGhpY2tuZXNzKHRoaWNrbmVzczogbnVtYmVyKSB7XG4gICAgdGhpcy5zZXRFZGl0b3JQcm9wZXJ0eShBbm5vdGF0aW9uRWRpdG9yUGFyYW1zVHlwZS5JTktfVEhJQ0tORVNTLCB0aGlja25lc3MpO1xuICB9XG5cbiAgcHVibGljIHNldCBlZGl0b3JIaWdobGlnaHRDb2xvcihjb2xvcjogc3RyaW5nKSB7XG4gICAgdGhpcy5zZXRFZGl0b3JQcm9wZXJ0eShBbm5vdGF0aW9uRWRpdG9yUGFyYW1zVHlwZS5ISUdITElHSFRfQ09MT1IsIGNvbG9yKTtcbiAgfVxuXG4gIHB1YmxpYyBzZXQgZWRpdG9ySGlnaGxpZ2h0RGVmYXVsdENvbG9yKGNvbG9yOiBzdHJpbmcpIHtcbiAgICB0aGlzLnNldEVkaXRvclByb3BlcnR5KEFubm90YXRpb25FZGl0b3JQYXJhbXNUeXBlLkhJR0hMSUdIVF9ERUZBVUxUX0NPTE9SLCBjb2xvcik7XG4gIH1cblxuICBwdWJsaWMgc2V0IGVkaXRvckhpZ2hsaWdodFNob3dBbGwoc2hvd0FsbDogYm9vbGVhbikge1xuICAgIHRoaXMuc2V0RWRpdG9yUHJvcGVydHkoQW5ub3RhdGlvbkVkaXRvclBhcmFtc1R5cGUuSElHSExJR0hUX1NIT1dfQUxMLCBzaG93QWxsKTtcbiAgfVxuXG4gIHB1YmxpYyBzZXQgZWRpdG9ySGlnaGxpZ2h0VGhpY2tuZXNzKHRoaWNrbmVzczogbnVtYmVyKSB7XG4gICAgdGhpcy5zZXRFZGl0b3JQcm9wZXJ0eShBbm5vdGF0aW9uRWRpdG9yUGFyYW1zVHlwZS5ISUdITElHSFRfVEhJQ0tORVNTLCB0aGlja25lc3MpO1xuICB9XG5cbiAgcHVibGljIHNldEVkaXRvclByb3BlcnR5KGVkaXRvclByb3BlcnR5VHlwZTogbnVtYmVyLCB2YWx1ZTogYW55KTogdm9pZCB7XG4gICAgdGhpcy5QREZWaWV3ZXJBcHBsaWNhdGlvbj8uZXZlbnRCdXMuZGlzcGF0Y2goJ3N3aXRjaGFubm90YXRpb25lZGl0b3JwYXJhbXMnLCB7IHR5cGU6IGVkaXRvclByb3BlcnR5VHlwZSwgdmFsdWUgfSk7XG4gICAgdGhpcy5QREZWaWV3ZXJBcHBsaWNhdGlvbj8uZXZlbnRCdXMuZGlzcGF0Y2goJ2Fubm90YXRpb25lZGl0b3JwYXJhbXNjaGFuZ2VkJywgeyBkZXRhaWxzOiBbW2VkaXRvclByb3BlcnR5VHlwZSwgdmFsdWVdXSB9KTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRDdXJyZW50UGFnZSgpOiBudW1iZXIge1xuICAgIGlmICghdGhpcy5QREZWaWV3ZXJBcHBsaWNhdGlvbikge1xuICAgICAgcmV0dXJuIDE7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLlBERlZpZXdlckFwcGxpY2F0aW9uLnBhZ2UgPz8gMTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRQYWdlQ291bnQoKTogbnVtYmVyIHtcbiAgICBpZiAoIXRoaXMuUERGVmlld2VyQXBwbGljYXRpb24pIHtcbiAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5QREZWaWV3ZXJBcHBsaWNhdGlvbi5wYWdlc0NvdW50ID8/IDA7XG4gIH1cblxuICBwdWJsaWMgbW92ZVBhZ2UoZnJvbUluZGV4OiBudW1iZXIsIHRvSW5kZXg6IG51bWJlcik6IHZvaWQge1xuICAgIGlmICghdGhpcy5QREZWaWV3ZXJBcHBsaWNhdGlvbikge1xuICAgICAgY29uc29sZS5lcnJvcignUERGIHZpZXdlciBub3QgaW5pdGlhbGl6ZWQnKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBDaGVjayBpZiBwYWdlIHJlb3JkZXJpbmcgaXMgZW5hYmxlZFxuICAgIGNvbnN0IGVuYWJsZVBhZ2VSZW9yZGVyaW5nID0gKGdsb2JhbFRoaXMgYXMgYW55KS5wZGZEZWZhdWx0T3B0aW9ucz8uZW5hYmxlUGFnZVJlb3JkZXJpbmc7XG4gICAgaWYgKCFlbmFibGVQYWdlUmVvcmRlcmluZykge1xuICAgICAgY29uc29sZS5lcnJvcignUGFnZSByZW9yZGVyaW5nIGlzIG5vdCBlbmFibGVkLiBTZXQgcGRmRGVmYXVsdE9wdGlvbnMuZW5hYmxlUGFnZVJlb3JkZXJpbmcgPSB0cnVlJyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gVmFsaWRhdGUgaW5kaWNlcyAoMS1iYXNlZClcbiAgICBjb25zdCBwYWdlQ291bnQgPSB0aGlzLmdldFBhZ2VDb3VudCgpO1xuICAgIGlmIChmcm9tSW5kZXggPCAxIHx8IGZyb21JbmRleCA+IHBhZ2VDb3VudCB8fCB0b0luZGV4IDwgMSB8fCB0b0luZGV4ID4gcGFnZUNvdW50KSB7XG4gICAgICBjb25zb2xlLmVycm9yKGBJbnZhbGlkIHBhZ2UgaW5kaWNlcy4gZnJvbUluZGV4OiAke2Zyb21JbmRleH0sIHRvSW5kZXg6ICR7dG9JbmRleH0sIHBhZ2VDb3VudDogJHtwYWdlQ291bnR9YCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKGZyb21JbmRleCA9PT0gdG9JbmRleCkge1xuICAgICAgcmV0dXJuOyAvLyBObyBtb3ZlbWVudCBuZWVkZWRcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgLy8gQ2FsbCB0aGUgbW92ZVBhZ2UgZnVuY3Rpb24gZnJvbSBhcHAuanNcbiAgICAgIGlmICh0aGlzLlBERlZpZXdlckFwcGxpY2F0aW9uLm1vdmVQYWdlKSB7XG4gICAgICAgIHRoaXMuUERGVmlld2VyQXBwbGljYXRpb24ubW92ZVBhZ2UoZnJvbUluZGV4LCB0b0luZGV4KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ21vdmVQYWdlIGZ1bmN0aW9uIG5vdCBhdmFpbGFibGUgaW4gUERGIHZpZXdlciBhcHBsaWNhdGlvbicpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBtb3ZpbmcgcGFnZTonLCBlcnJvcik7XG4gICAgfVxuICB9XG59XG4iXX0=